<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/blog/icon.png"><script>var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?1876f64fd31c9aba1a7a5e157813a075";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();</script><title>props处理 | 汪图南</title><meta name="description" content="汪图南的个人博客">
    <link rel="preload" href="/blog/assets/style-5927efb2.css" as="style"><link rel="stylesheet" href="/blog/assets/style-5927efb2.css">
    <link rel="modulepreload" href="/blog/assets/app-c9f86c19.js"><link rel="modulepreload" href="/blog/assets/props.html-e9040bec.js"><link rel="modulepreload" href="/blog/assets/props.html-e2c6601d.js"><link rel="prefetch" href="/blog/assets/index.html-280695a8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fe18cc93.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bd6c66e6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5553d3bc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c4bef9f7.js" as="script"><link rel="prefetch" href="/blog/assets/vueTest.html-0925f0bd.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-3a9c6c45.js" as="script"><link rel="prefetch" href="/blog/assets/challenge.html-ae0a31b6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-10ae514e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f805a31e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-949f31b4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6afaaa2d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-87e41843.js" as="script"><link rel="prefetch" href="/blog/assets/algorithm.html-6a115684.js" as="script"><link rel="prefetch" href="/blog/assets/es6.html-f978d04d.js" as="script"><link rel="prefetch" href="/blog/assets/know-down.html-5056c6b6.js" as="script"><link rel="prefetch" href="/blog/assets/know-up.html-d675df93.js" as="script"><link rel="prefetch" href="/blog/assets/red-book.html-ca818111.js" as="script"><link rel="prefetch" href="/blog/assets/vue.html-3873be59.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4995f8be.js" as="script"><link rel="prefetch" href="/blog/assets/gin.html-38dc901e.js" as="script"><link rel="prefetch" href="/blog/assets/gorm.html-049e6576.js" as="script"><link rel="prefetch" href="/blog/assets/mod.html-51d91586.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-188aad87.js" as="script"><link rel="prefetch" href="/blog/assets/codegen.html-ec3e4b2a.js" as="script"><link rel="prefetch" href="/blog/assets/compileToFunctions.html-8bfbe25d.js" as="script"><link rel="prefetch" href="/blog/assets/optimize.html-aa4990ca.js" as="script"><link rel="prefetch" href="/blog/assets/parse.html-091e449b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cdee3d22.js" as="script"><link rel="prefetch" href="/blog/assets/async.html-a138e986.js" as="script"><link rel="prefetch" href="/blog/assets/createComponent.html-bb775c81.js" as="script"><link rel="prefetch" href="/blog/assets/createElement.html-03ddd014.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-c08b02f0.js" as="script"><link rel="prefetch" href="/blog/assets/merge.html-5bc90f20.js" as="script"><link rel="prefetch" href="/blog/assets/mount.html-2e474fcd.js" as="script"><link rel="prefetch" href="/blog/assets/patch.html-8ce5c431.js" as="script"><link rel="prefetch" href="/blog/assets/register.html-17684435.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-060880ef.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9602cdff.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2ef2dd5b.js" as="script"><link rel="prefetch" href="/blog/assets/diff.html-e5bb3928.js" as="script"><link rel="prefetch" href="/blog/assets/vnode.html-721ee9d2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b3dce1ee.js" as="script"><link rel="prefetch" href="/blog/assets/events.html-aef20d44.js" as="script"><link rel="prefetch" href="/blog/assets/global.html-2ae402bf.js" as="script"><link rel="prefetch" href="/blog/assets/init.html-59717308.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-ed22a3ac.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-45f84050.js" as="script"><link rel="prefetch" href="/blog/assets/state.html-ead69447.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c6862bd3.js" as="script"><link rel="prefetch" href="/blog/assets/directive.html-5dd9c507.js" as="script"><link rel="prefetch" href="/blog/assets/event.html-50b6d777.js" as="script"><link rel="prefetch" href="/blog/assets/filter.html-7ce4cab5.js" as="script"><link rel="prefetch" href="/blog/assets/keep-alive.html-41069b7a.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-d57aa47d.js" as="script"><link rel="prefetch" href="/blog/assets/slot.html-15af974b.js" as="script"><link rel="prefetch" href="/blog/assets/transition-group.html-6c8fcf2c.js" as="script"><link rel="prefetch" href="/blog/assets/transition.html-f7943ef2.js" as="script"><link rel="prefetch" href="/blog/assets/vmodel.html-616fe997.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-73f4ab4d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ca6c17d8.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-79261e9e.js" as="script"><link rel="prefetch" href="/blog/assets/computed.html-356d3ae7.js" as="script"><link rel="prefetch" href="/blog/assets/data.html-3230ac16.js" as="script"><link rel="prefetch" href="/blog/assets/dep.html-b563f57d.js" as="script"><link rel="prefetch" href="/blog/assets/methods.html-06afd821.js" as="script"><link rel="prefetch" href="/blog/assets/nexttick.html-f0c456d4.js" as="script"><link rel="prefetch" href="/blog/assets/notify.html-664a3268.js" as="script"><link rel="prefetch" href="/blog/assets/prepare.html-29744f8b.js" as="script"><link rel="prefetch" href="/blog/assets/problem.html-c6bd1660.js" as="script"><link rel="prefetch" href="/blog/assets/reactive.html-908907fc.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-b9024a96.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-02777000.js" as="script"><link rel="prefetch" href="/blog/assets/vue.html-87f04143.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-84f2dc62.js" as="script"><link rel="prefetch" href="/blog/assets/change.html-106039c0.js" as="script"><link rel="prefetch" href="/blog/assets/components.html-83a62c45.js" as="script"><link rel="prefetch" href="/blog/assets/hooks.html-23e0ee41.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-c1ddcd11.js" as="script"><link rel="prefetch" href="/blog/assets/matcher.html-904dda15.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6e5f7cc2.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-cbd13323.js" as="script"><link rel="prefetch" href="/blog/assets/init.html-9d7ddd75.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-8a6c8baf.js" as="script"><link rel="prefetch" href="/blog/assets/utils.html-ae42e0ab.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-24437acf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-85071f13.js" as="script"><link rel="prefetch" href="/blog/assets/createApp.html-bc8d202d.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-43d1b52c.js" as="script"><link rel="prefetch" href="/blog/assets/mount.html-758f42a5.js" as="script"><link rel="prefetch" href="/blog/assets/register.html-7f8f1106.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-2b6b5617.js" as="script"><link rel="prefetch" href="/blog/assets/setup.html-3f0dac85.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f212d6e6.js" as="script"><link rel="prefetch" href="/blog/assets/optimization.html-aa599a27.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-78293644.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c43f9288.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-f27879f5.js" as="script"><link rel="prefetch" href="/blog/assets/computed.html-9e8f4631.js" as="script"><link rel="prefetch" href="/blog/assets/reactive.html-4b602f4a.js" as="script"><link rel="prefetch" href="/blog/assets/readonly.html-b6e3ba40.js" as="script"><link rel="prefetch" href="/blog/assets/ref.html-6bf98d2b.js" as="script"><link rel="prefetch" href="/blog/assets/track.html-1151ad60.js" as="script"><link rel="prefetch" href="/blog/assets/trigger.html-65dd2b49.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-9bf7acd6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f477e16f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-de435860.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-18da6bca.js" as="script"><link rel="prefetch" href="/blog/assets/advanced.html-4c2c22cf.js" as="script"><link rel="prefetch" href="/blog/assets/case.html-542c1d3f.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-55c9b6f9.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-ce85b2e2.js" as="script"><link rel="prefetch" href="/blog/assets/loader.html-06006cea.js" as="script"><link rel="prefetch" href="/blog/assets/optimization.html-1203a7f5.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-2e7bde78.js" as="script"><link rel="prefetch" href="/blog/assets/source.html-d8b72cb3.js" as="script"><link rel="prefetch" href="/blog/assets/start.html-5964675f.js" as="script"><link rel="prefetch" href="/blog/assets/static.html-428c0bd5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ac95a065.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4b546e67.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3532503b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-94facb5e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0510a3bd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f6c0d421.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a6140447.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5c1a1bbb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9bb816f4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a664b454.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-aa2b023d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4258f9c3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0cc658a4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-343efa40.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4a5904e0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-719b579b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2266584f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8bf54ba6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-eb60efe0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9976f3f4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-794aa326.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-274a3c73.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-358d263a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-54320ac6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b8e7c8c0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e6105694.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5ba1691d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3fc42a26.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-60a507c2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-93d08a5f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ec31b645.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-61b75580.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f2c40ae6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f7c40fb6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0c97a7da.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-91bf625c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-227f6aec.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-196047b7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e7c51c13.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dc464326.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8ecc6de8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-35d4e57e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a9b519c0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-adaa5083.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0148448c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0ae836c9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a1a36e50.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7b17d10a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-16e88788.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-24fc7618.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-341cc7fe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a0b6afd2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4d986f3c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-94b0bbfe.js" as="script"><link rel="prefetch" href="/blog/assets/vueTest.html-513e4a77.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-6d7737ba.js" as="script"><link rel="prefetch" href="/blog/assets/challenge.html-37933c3f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-39bf71a7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8f6912e6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-203db80c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2ae80ad4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ae47dd6b.js" as="script"><link rel="prefetch" href="/blog/assets/algorithm.html-5b37fe92.js" as="script"><link rel="prefetch" href="/blog/assets/es6.html-9dcd1203.js" as="script"><link rel="prefetch" href="/blog/assets/know-down.html-97b7e892.js" as="script"><link rel="prefetch" href="/blog/assets/know-up.html-a6184f1a.js" as="script"><link rel="prefetch" href="/blog/assets/red-book.html-45f3ccd2.js" as="script"><link rel="prefetch" href="/blog/assets/vue.html-1d60f168.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-66fe7a38.js" as="script"><link rel="prefetch" href="/blog/assets/gin.html-8444f679.js" as="script"><link rel="prefetch" href="/blog/assets/gorm.html-7b902b5b.js" as="script"><link rel="prefetch" href="/blog/assets/mod.html-607855bf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b45ab427.js" as="script"><link rel="prefetch" href="/blog/assets/codegen.html-b79bd90d.js" as="script"><link rel="prefetch" href="/blog/assets/compileToFunctions.html-22aa2505.js" as="script"><link rel="prefetch" href="/blog/assets/optimize.html-a6896773.js" as="script"><link rel="prefetch" href="/blog/assets/parse.html-05df3592.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8b105569.js" as="script"><link rel="prefetch" href="/blog/assets/async.html-84ad24b3.js" as="script"><link rel="prefetch" href="/blog/assets/createComponent.html-848c089f.js" as="script"><link rel="prefetch" href="/blog/assets/createElement.html-da1d674a.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-79b6b8f9.js" as="script"><link rel="prefetch" href="/blog/assets/merge.html-a147ef57.js" as="script"><link rel="prefetch" href="/blog/assets/mount.html-51dae810.js" as="script"><link rel="prefetch" href="/blog/assets/patch.html-791f37fa.js" as="script"><link rel="prefetch" href="/blog/assets/register.html-4153c261.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-af467dc2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3d418d0a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ba53e2d8.js" as="script"><link rel="prefetch" href="/blog/assets/diff.html-fa424776.js" as="script"><link rel="prefetch" href="/blog/assets/vnode.html-f212121e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5f7fed7d.js" as="script"><link rel="prefetch" href="/blog/assets/events.html-4743c6c7.js" as="script"><link rel="prefetch" href="/blog/assets/global.html-b9da3c8e.js" as="script"><link rel="prefetch" href="/blog/assets/init.html-e8f10fc4.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-5a1f785b.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-07bbb357.js" as="script"><link rel="prefetch" href="/blog/assets/state.html-436347e9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8a1978d5.js" as="script"><link rel="prefetch" href="/blog/assets/directive.html-08e546c0.js" as="script"><link rel="prefetch" href="/blog/assets/event.html-568f6e0a.js" as="script"><link rel="prefetch" href="/blog/assets/filter.html-def6328f.js" as="script"><link rel="prefetch" href="/blog/assets/keep-alive.html-9de153c1.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-ae62685d.js" as="script"><link rel="prefetch" href="/blog/assets/slot.html-cffb9b80.js" as="script"><link rel="prefetch" href="/blog/assets/transition-group.html-49ac25b1.js" as="script"><link rel="prefetch" href="/blog/assets/transition.html-c6f2b97b.js" as="script"><link rel="prefetch" href="/blog/assets/vmodel.html-513e85a9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-790e90b4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7a7706ec.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-a3ae02f6.js" as="script"><link rel="prefetch" href="/blog/assets/computed.html-68c43c34.js" as="script"><link rel="prefetch" href="/blog/assets/data.html-b51454aa.js" as="script"><link rel="prefetch" href="/blog/assets/dep.html-111f64de.js" as="script"><link rel="prefetch" href="/blog/assets/methods.html-f36d630c.js" as="script"><link rel="prefetch" href="/blog/assets/nexttick.html-b4301a33.js" as="script"><link rel="prefetch" href="/blog/assets/notify.html-3c835083.js" as="script"><link rel="prefetch" href="/blog/assets/prepare.html-e6a0e3f3.js" as="script"><link rel="prefetch" href="/blog/assets/problem.html-c4ddfa6a.js" as="script"><link rel="prefetch" href="/blog/assets/reactive.html-dc725c03.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-1eb51a0a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b9041c93.js" as="script"><link rel="prefetch" href="/blog/assets/vue.html-906a1525.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-36756850.js" as="script"><link rel="prefetch" href="/blog/assets/change.html-b5e68022.js" as="script"><link rel="prefetch" href="/blog/assets/components.html-4622289a.js" as="script"><link rel="prefetch" href="/blog/assets/hooks.html-0f7fbaa8.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-e74178fc.js" as="script"><link rel="prefetch" href="/blog/assets/matcher.html-df1b1aea.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dfbf7d71.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-0437e9cc.js" as="script"><link rel="prefetch" href="/blog/assets/init.html-ff103051.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-a98b4cf1.js" as="script"><link rel="prefetch" href="/blog/assets/utils.html-9c01c2bb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dd91621b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e3f85693.js" as="script"><link rel="prefetch" href="/blog/assets/createApp.html-141c4f6f.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-b9bebb2e.js" as="script"><link rel="prefetch" href="/blog/assets/mount.html-3b070bed.js" as="script"><link rel="prefetch" href="/blog/assets/register.html-763a07de.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-3c0992cc.js" as="script"><link rel="prefetch" href="/blog/assets/setup.html-66da367b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f2ad824c.js" as="script"><link rel="prefetch" href="/blog/assets/optimization.html-a2a40da1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c2fd0d46.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-be023ec1.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-1a80b03c.js" as="script"><link rel="prefetch" href="/blog/assets/computed.html-f08c0693.js" as="script"><link rel="prefetch" href="/blog/assets/reactive.html-4afe327f.js" as="script"><link rel="prefetch" href="/blog/assets/readonly.html-51f33599.js" as="script"><link rel="prefetch" href="/blog/assets/ref.html-ac921ebf.js" as="script"><link rel="prefetch" href="/blog/assets/track.html-e97b34d3.js" as="script"><link rel="prefetch" href="/blog/assets/trigger.html-e0b02601.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-3dfe45ba.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ed2c8e0b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-64c67c4a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-add6c79e.js" as="script"><link rel="prefetch" href="/blog/assets/advanced.html-4087c7e2.js" as="script"><link rel="prefetch" href="/blog/assets/case.html-468c156b.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-d46e24e6.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-b637d679.js" as="script"><link rel="prefetch" href="/blog/assets/loader.html-d21b7c06.js" as="script"><link rel="prefetch" href="/blog/assets/optimization.html-6a127518.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-965f5eb8.js" as="script"><link rel="prefetch" href="/blog/assets/source.html-415b2404.js" as="script"><link rel="prefetch" href="/blog/assets/start.html-00708b66.js" as="script"><link rel="prefetch" href="/blog/assets/static.html-3318a1c3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e33dff55.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0cd95589.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-611b18af.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e1c96fe6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9632c31b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d247f0cf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dc2cf399.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e7eed6aa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7806d541.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ca33ecff.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-68f2a000.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-342b7567.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-42beb573.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-21d70b3f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fa8a9f91.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2be2f18c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-477e0d3a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b52482ef.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fc47c41d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-429c7bc2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ea25fa71.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1c7adbea.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-347b428b.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8bb80fa0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-34105682.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7aecdc18.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d4fd32fe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b598af87.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f16a3111.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d02b6366.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4021ab03.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e03a5de6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-03dc20be.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-38c439d5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c524cd2c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1b9dcfe2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0b8b1d02.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-87344cc7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-472c9c76.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2f585ad8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-b5905186.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-57b20e57.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9d781573.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-13591608.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0bede3d4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-41ab10ac.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-13d3f92e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-53b5c8ce.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-72332b17.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-c801f47a.js" as="script"><link rel="prefetch" href="/blog/assets/leetcodeLink-975b54e0.js" as="script"><link rel="prefetch" href="/blog/assets/linkAndSolution-4b225242.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-8d5a43f1.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container" data-v-e3e878f2><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><!----><span class="site-name">汪图南</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/interview/" class="" aria-label="前端面试之道"><!--[--><!--]--> 前端面试之道 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>打包工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/webpack/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/rollup/" class="" aria-label="Rollup"><!--[--><!--]--> Rollup <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TypeScript</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/typescript/base" class="" aria-label="TypeScript基础"><!--[--><!--]--> TypeScript基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/typescript/challenge" class="" aria-label="TypeScript类型挑战"><!--[--><!--]--> TypeScript类型挑战 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>CSS预编译器</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/cssPrecompiler/sass/" class="" aria-label="SASS"><!--[--><!--]--> SASS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>自动化测试</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/test/vueTest" class="" aria-label="Vue应用测试"><!--[--><!--]--> Vue应用测试 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/vueAnalysis/introduction/" class="" aria-label="Vue2.0源码分析"><!--[--><!--]--> Vue2.0源码分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/vueNextAnalysis/introduction/" class="" aria-label="Vue3.0源码分析"><!--[--><!--]--> Vue3.0源码分析 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/algorithm/base/introduction/" class="" aria-label="数据结构和算法(基础)"><!--[--><!--]--> 数据结构和算法(基础) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/algorithm/leetcode/introduction" class="" aria-label="LeetCode(刷题)"><!--[--><!--]--> LeetCode(刷题) <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Golang技术栈"><span class="title">Golang技术栈</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Golang技术栈"><span class="title">Golang技术栈</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/golang/base" class="" aria-label="Go基础"><!--[--><!--]--> Go基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Go框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/golang/framework/gin" class="" aria-label="Gin"><!--[--><!--]--> Gin <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/golang/framework/gorm" class="" aria-label="Gorm"><!--[--><!--]--> Gorm <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Go工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/golang/mod" class="" aria-label="Go Modules"><!--[--><!--]--> Go Modules <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书籍"><span class="title">书籍</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书籍"><span class="title">书籍</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>JavaScript书籍</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/know-up" class="" aria-label="你不知道的JavaScript(上)"><!--[--><!--]--> 你不知道的JavaScript(上) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/know-down" class="" aria-label="你不知道的JavaScript(中下)"><!--[--><!--]--> 你不知道的JavaScript(中下) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/algorithm" class="" aria-label="JavaScript数据结构和算法"><!--[--><!--]--> JavaScript数据结构和算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/designPattern/" class="" aria-label="JavaScript设计模式与开发实践"><!--[--><!--]--> JavaScript设计模式与开发实践 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/es6" class="" aria-label="深入理解ES6"><!--[--><!--]--> 深入理解ES6 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Git书籍</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/books/git/" class="" aria-label="精通Git"><!--[--><!--]--> 精通Git <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/wangtunan/blog" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/interview/" class="" aria-label="前端面试之道"><!--[--><!--]--> 前端面试之道 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>打包工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/webpack/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/rollup/" class="" aria-label="Rollup"><!--[--><!--]--> Rollup <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>TypeScript</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/typescript/base" class="" aria-label="TypeScript基础"><!--[--><!--]--> TypeScript基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/typescript/challenge" class="" aria-label="TypeScript类型挑战"><!--[--><!--]--> TypeScript类型挑战 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>CSS预编译器</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/cssPrecompiler/sass/" class="" aria-label="SASS"><!--[--><!--]--> SASS <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>自动化测试</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/test/vueTest" class="" aria-label="Vue应用测试"><!--[--><!--]--> Vue应用测试 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/vueAnalysis/introduction/" class="" aria-label="Vue2.0源码分析"><!--[--><!--]--> Vue2.0源码分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/vueNextAnalysis/introduction/" class="" aria-label="Vue3.0源码分析"><!--[--><!--]--> Vue3.0源码分析 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/algorithm/base/introduction/" class="" aria-label="数据结构和算法(基础)"><!--[--><!--]--> 数据结构和算法(基础) <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/blog/algorithm/leetcode/introduction" class="" aria-label="LeetCode(刷题)"><!--[--><!--]--> LeetCode(刷题) <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Golang技术栈"><span class="title">Golang技术栈</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Golang技术栈"><span class="title">Golang技术栈</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/golang/base" class="" aria-label="Go基础"><!--[--><!--]--> Go基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Go框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/golang/framework/gin" class="" aria-label="Gin"><!--[--><!--]--> Gin <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/golang/framework/gorm" class="" aria-label="Gorm"><!--[--><!--]--> Gorm <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Go工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/golang/mod" class="" aria-label="Go Modules"><!--[--><!--]--> Go Modules <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="书籍"><span class="title">书籍</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="书籍"><span class="title">书籍</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>JavaScript书籍</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/know-up" class="" aria-label="你不知道的JavaScript(上)"><!--[--><!--]--> 你不知道的JavaScript(上) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/know-down" class="" aria-label="你不知道的JavaScript(中下)"><!--[--><!--]--> 你不知道的JavaScript(中下) <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/algorithm" class="" aria-label="JavaScript数据结构和算法"><!--[--><!--]--> JavaScript数据结构和算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/designPattern/" class="" aria-label="JavaScript设计模式与开发实践"><!--[--><!--]--> JavaScript设计模式与开发实践 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/books/javascript/es6" class="" aria-label="深入理解ES6"><!--[--><!--]--> 深入理解ES6 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Git书籍</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/books/git/" class="" aria-label="精通Git"><!--[--><!--]--> 精通Git <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/wangtunan/blog" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">介绍 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/introduction/" class="sidebar-item" aria-label="介绍和参考"><!--[--><!--]--> 介绍和参考 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">源码目录设计和架构设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/design/" class="sidebar-item" aria-label="设计"><!--[--><!--]--> 设计 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Rollup构建版本 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/rollup/" class="sidebar-item" aria-label="Rollup基础知识"><!--[--><!--]--> Rollup基础知识 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/rollup/vue.html" class="sidebar-item" aria-label="Vue中的Rollup构建"><!--[--><!--]--> Vue中的Rollup构建 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">从入口到构造函数整体流程 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/entry/" class="sidebar-item" aria-label="整体流程"><!--[--><!--]--> 整体流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/entry/global.html" class="sidebar-item" aria-label="initGlobalAPI流程"><!--[--><!--]--> initGlobalAPI流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/entry/init.html" class="sidebar-item" aria-label="initMixin流程"><!--[--><!--]--> initMixin流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/entry/state.html" class="sidebar-item" aria-label="stateMixin流程"><!--[--><!--]--> stateMixin流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/entry/events.html" class="sidebar-item" aria-label="eventsMixin流程"><!--[--><!--]--> eventsMixin流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/entry/lifecycle.html" class="sidebar-item" aria-label="lifecycleMixin流程"><!--[--><!--]--> lifecycleMixin流程 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/entry/render.html" class="sidebar-item" aria-label="renderMixin流程"><!--[--><!--]--> renderMixin流程 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">响应式原理 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/reactive/" class="router-link-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/prepare.html" class="sidebar-item" aria-label="前置核心概念"><!--[--><!--]--> 前置核心概念 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="props处理"><!--[--><!--]--> props处理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#props规范化" class="router-link-active router-link-exact-active sidebar-item" aria-label="props规范化"><!--[--><!--]--> props规范化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#props初始化" class="router-link-active router-link-exact-active sidebar-item" aria-label="props初始化"><!--[--><!--]--> props初始化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#props响应式" class="router-link-active router-link-exact-active sidebar-item" aria-label="props响应式"><!--[--><!--]--> props响应式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#props代理" class="router-link-active router-link-exact-active sidebar-item" aria-label="props代理"><!--[--><!--]--> props代理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#props校验求值" class="router-link-active router-link-exact-active sidebar-item" aria-label="props校验求值"><!--[--><!--]--> props校验求值 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#props更新" class="router-link-active router-link-exact-active sidebar-item" aria-label="props更新"><!--[--><!--]--> props更新 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#toggleobserving作用" class="router-link-active router-link-exact-active sidebar-item" aria-label="toggleObserving作用"><!--[--><!--]--> toggleObserving作用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/vueAnalysis/reactive/props.html#整体流程图" class="router-link-active router-link-exact-active sidebar-item" aria-label="整体流程图"><!--[--><!--]--> 整体流程图 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/blog/vueAnalysis/reactive/methods.html" class="sidebar-item" aria-label="methods处理"><!--[--><!--]--> methods处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/data.html" class="sidebar-item" aria-label="data处理"><!--[--><!--]--> data处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/computed.html" class="sidebar-item" aria-label="computed处理"><!--[--><!--]--> computed处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/watch.html" class="sidebar-item" aria-label="watch处理"><!--[--><!--]--> watch处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/reactive.html" class="sidebar-item" aria-label="深入响应式原理"><!--[--><!--]--> 深入响应式原理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/dep.html" class="sidebar-item" aria-label="依赖收集"><!--[--><!--]--> 依赖收集 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/notify.html" class="sidebar-item" aria-label="派发更新"><!--[--><!--]--> 派发更新 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/nexttick.html" class="sidebar-item" aria-label="nextTick实现原理"><!--[--><!--]--> nextTick实现原理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/problem.html" class="sidebar-item" aria-label="变化侦测注意事项"><!--[--><!--]--> 变化侦测注意事项 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/reactive/api.html" class="sidebar-item" aria-label="变化侦测API实现"><!--[--><!--]--> 变化侦测API实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">虚拟DOM和VNode <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/dom/" class="sidebar-item" aria-label="虚拟DOM"><!--[--><!--]--> 虚拟DOM <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/dom/vnode.html" class="sidebar-item" aria-label="VNode介绍"><!--[--><!--]--> VNode介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/dom/diff.html" class="sidebar-item" aria-label="Diff算法"><!--[--><!--]--> Diff算法 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">组件化 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/component/" class="sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/mount.html" class="sidebar-item" aria-label="$mount方法"><!--[--><!--]--> $mount方法 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/render.html" class="sidebar-item" aria-label="render和renderProxy"><!--[--><!--]--> render和renderProxy <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/createElement.html" class="sidebar-item" aria-label="createElement"><!--[--><!--]--> createElement <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/createComponent.html" class="sidebar-item" aria-label="createComponent"><!--[--><!--]--> createComponent <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/merge.html" class="sidebar-item" aria-label="合并策略"><!--[--><!--]--> 合并策略 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/patch.html" class="sidebar-item" aria-label="update和patch"><!--[--><!--]--> update和patch <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/lifecycle.html" class="sidebar-item" aria-label="组件生命周期"><!--[--><!--]--> 组件生命周期 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/component/register.html" class="sidebar-item" aria-label="组件注册"><!--[--><!--]--> 组件注册 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">编译原理 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/compile/" class="sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/compile/compileToFunctions.html" class="sidebar-item" aria-label="compileToFunctions"><!--[--><!--]--> compileToFunctions <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/compile/parse.html" class="sidebar-item" aria-label="parse模板解析"><!--[--><!--]--> parse模板解析 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/compile/optimize.html" class="sidebar-item" aria-label="optimize优化"><!--[--><!--]--> optimize优化 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/compile/codegen.html" class="sidebar-item" aria-label="codegen代码生成"><!--[--><!--]--> codegen代码生成 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">扩展 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/expand/" class="sidebar-item" aria-label="扩展"><!--[--><!--]--> 扩展 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/directive.html" class="sidebar-item" aria-label="directive指令"><!--[--><!--]--> directive指令 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/filter.html" class="sidebar-item" aria-label="filter过滤器"><!--[--><!--]--> filter过滤器 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/event.html" class="sidebar-item" aria-label="event事件处理"><!--[--><!--]--> event事件处理 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/vmodel.html" class="sidebar-item" aria-label="v-model"><!--[--><!--]--> v-model <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/slot.html" class="sidebar-item" aria-label="插槽"><!--[--><!--]--> 插槽 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/keep-alive.html" class="sidebar-item" aria-label="Keep-Alive"><!--[--><!--]--> Keep-Alive <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/transition.html" class="sidebar-item" aria-label="Transition"><!--[--><!--]--> Transition <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/transition-group.html" class="sidebar-item" aria-label="Transition-Group"><!--[--><!--]--> Transition-Group <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/expand/plugin.html" class="sidebar-item" aria-label="Vue.use插件机制"><!--[--><!--]--> Vue.use插件机制 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Vue-Router <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/router/" class="sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/router/install.html" class="sidebar-item" aria-label="路由安装"><!--[--><!--]--> 路由安装 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/router/matcher.html" class="sidebar-item" aria-label="matcher介绍"><!--[--><!--]--> matcher介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/router/change.html" class="sidebar-item" aria-label="路由切换"><!--[--><!--]--> 路由切换 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/router/components.html" class="sidebar-item" aria-label="内置组件"><!--[--><!--]--> 内置组件 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/router/hooks.html" class="sidebar-item" aria-label="路由hooks钩子函数"><!--[--><!--]--> 路由hooks钩子函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Vuex <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/vueAnalysis/vuex/" class="sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/vuex/install.html" class="sidebar-item" aria-label="Vuex安装"><!--[--><!--]--> Vuex安装 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/vuex/init.html" class="sidebar-item" aria-label="Vuex初始化"><!--[--><!--]--> Vuex初始化 <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/vuex/utils.html" class="sidebar-item" aria-label="Vuex辅助API"><!--[--><!--]--> Vuex辅助API <!--[--><!--]--></a><!----></li><li><a href="/blog/vueAnalysis/vuex/api.html" class="sidebar-item" aria-label="Store实例API"><!--[--><!--]--> Store实例API <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="props处理" tabindex="-1"><a class="header-anchor" href="#props处理" aria-hidden="true">#</a> props处理</h1><p>介绍完以上前置核心概念后，我们第一个要学习的就是<code>Vue.js</code>是如何处理与<code>props</code>相关的逻辑的。我们把与<code>props</code>相关的逻辑主要分成三个部分，分别是<code>props</code>规范化、<code>props</code>初始化和<code>props</code>更新。</p><h2 id="props规范化" tabindex="-1"><a class="header-anchor" href="#props规范化" aria-hidden="true">#</a> props规范化</h2><p>在了解规范化之前，我们先来列举一下在日常的开发过程中，我们主要有如下几种撰写组件<code>props</code>的方式：</p><ul><li>数组形式：<code>props</code>可以写成一个数组，但数组中的<code>key</code>元素必须为<code>string</code>类型。</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>键值不为对象：此种方式常见于只需要定义<code>key</code>类型的<code>props</code>。</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>规范格式：此种方式是<code>Vue.js</code>接受<code>props</code>最好的格式，对于一个有很高要求的组件来说，它通常会撰写很严格的<code>props</code>规则，这在各个开源UI框架中是最常见的。</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&lt;=</span> <span class="token number">100</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>而<code>props</code>规范化所做的事情，就是把各种不是规范格式的形式，规范化为规范格式，方便<code>Vue.js</code>在后续的过程中处理<code>props</code>。那么接下来，我们就来分析<code>Vue.js</code>是如何对<code>props</code>规范化的。</p><p><code>props</code>规范化的过程发生在<code>this._init()</code>方法中的<code>mergeOptions</code>合并配置中：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mergeOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../util/index&#39;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">_init</span> <span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token keyword">this</span>
  vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
    <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">,</span>
    options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    vm
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中<code>mergeOptions()</code>方法是定义在<code>src/core/util/options.js</code>文件中，它在其中有一段这样的方法调用：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeOptions</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parent</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token comment">// 省略代码</span>
  <span class="token function">normalizeProps</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token keyword">return</span> options
<span class="token punctuation">}</span> 
</code></pre></div><p>我们可以发现，规范化<code>props</code>的代码，主要集中在<code>normalizeProps()</code>方法中，那么接下来我们详细分析<code>normalizeProps()</code>方法：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">normalizeProps</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">options</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> options<span class="token punctuation">.</span>props
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> i<span class="token punctuation">,</span> val<span class="token punctuation">,</span> name
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">=</span> props<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> props<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        res<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;props must be strings when using array syntax.&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      name <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      res<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        <span class="token operator">?</span> val
        <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> val <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invalid value for option &quot;props&quot;: expected an Array or an Object, </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">but got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">toRawType</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  options<span class="token punctuation">.</span>props <span class="token operator">=</span> res
<span class="token punctuation">}</span>
</code></pre></div><p>为了更好的理解<code>normalizeProps()</code>方法，我们来撰写几个案例来详细说明：</p><ul><li>数组形式：当<code>props</code>是数组时，会首先倒序遍历这个数组，然后使用<code>typeof</code>来判断数组元素的类型。如果不是<code>string</code>类型，则在开发环境下报错，如果是<code>string</code>类型，则先把<code>key</code>转化为驼峰形式，然后把这个<code>key</code>赋值到临时的<code>res</code>对象中，此时的键值固定为<code>{ type: null }</code></li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 规范化前</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;nick-name&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 规范化后</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>对象形式：当为对象时会使用<code>for-in</code>遍历对象，紧接着和数组形式一样使用<code>camelize</code>来把<code>key</code>转成驼峰形式，然后使用<code>isPlainObject()</code>方法来判断是否为普通对象。如果不是，则转成<code>{ type: Type }</code>对象形式，其中<code>Type</code>为定义<code>key</code>时的<code>Type</code>，如果是，则直接使用这个对象。</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 规范化前</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> Number
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 规范化后</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Number
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>既不是数组形式也不是对象形式：报错</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 报错：Invalid value for option &quot;props&quot;: expected an Array or an Object，but got String</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token string">&#39;name, age&#39;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="props初始化" tabindex="-1"><a class="header-anchor" href="#props初始化" aria-hidden="true">#</a> props初始化</h2><p>在了解了<code>props</code>规范化后，我们紧接着来了解一下<code>props</code>初始化的过程。<code>props</code>初始化过程同样是发生在<code>this._init()</code>方法中，它在<code>initState</code>的时候被处理：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter">vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 省略代码</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后我们来详细看一下<code>initProps</code>中的代码：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component<span class="token punctuation">,</span> <span class="token literal-property property">propsOptions</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> propsData <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> isRoot <span class="token operator">=</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$parent
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propsOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hyphenatedKey <span class="token operator">=</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isReservedAttribute</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span> <span class="token operator">||</span>
          config<span class="token punctuation">.</span><span class="token function">isReservedAttr</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hyphenatedKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is a reserved attribute and cannot be used as component prop.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Avoid mutating a prop directly since the value will be </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">overwritten whenever the parent component re-renders. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Instead, use a data or computed property based on the prop&#39;s </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value. Prop being mutated: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            vm
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在仔细阅读<code>initProps()</code>方法后，我们可以对<code>initProps()</code>方法进行总结，它主要做三件事情：<strong>props校验和求值</strong>、<strong>props响应式</strong>和<strong>props代理</strong>。</p><h3 id="props响应式" tabindex="-1"><a class="header-anchor" href="#props响应式" aria-hidden="true">#</a> props响应式</h3><p>我们先来看看最简单的<code>props</code>响应式，这部分的过程主要使用了我们在之前介绍过的<code>defineReactive</code>方法：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Avoid mutating a prop directly since the value will be </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">overwritten whenever the parent component re-renders. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Instead, use a data or computed property based on the prop&#39;s </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value. Prop being mutated: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>唯一值得注意的地方就是：在开发环境下，<code>props</code>的响应式劫持了<code>setter</code>方法，这样做的是为了保证<code>props</code>为单项数据流：既我们不能在子组件中直接修改父组件传递的<code>props</code>值。</p><h3 id="props代理" tabindex="-1"><a class="header-anchor" href="#props代理" aria-hidden="true">#</a> props代理</h3><p>经过<code>props</code>响应式后，我们会在实例上得到<code>this._props</code>对象，为了方便我们更好的获取<code>props</code>的值，我们需要对<code>props</code>做一层<code>proxy</code>代理。关于<code>proxy</code>的实现，我们已经在之前的章节中介绍过了。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token comment">// 代理前</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_props<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token comment">// 代理后</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><h3 id="props校验求值" tabindex="-1"><a class="header-anchor" href="#props校验求值" aria-hidden="true">#</a> props校验求值</h3><p>最后我们来看稍微复杂一点的<code>props</code>校验求值，这部分的功能发生在<code>validateProp</code>，它的代码如下：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateProp</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">propOptions</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">propsData</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prop <span class="token operator">=</span> propOptions<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">const</span> absent <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>propsData<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token comment">// boolean casting</span>
  <span class="token keyword">const</span> booleanIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>booleanIndex <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>absent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// only cast empty string / same name to boolean if</span>
      <span class="token comment">// boolean has higher priority</span>
      <span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stringIndex <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> booleanIndex <span class="token operator">&lt;</span> stringIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// check default value</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token function">getPropDefaultValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token comment">// since the default value is a fresh copy,</span>
    <span class="token comment">// make sure to observe it.</span>
    <span class="token keyword">const</span> prevShouldObserve <span class="token operator">=</span> shouldObserve
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span>prevShouldObserve<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span>
    <span class="token comment">// skip validation for weex recycle-list child component props</span>
    <span class="token operator">!</span><span class="token punctuation">(</span>__WEEX__ <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token string">&#39;@binding&#39;</span> <span class="token keyword">in</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertProp</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> absent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
</code></pre></div><p><strong>代码分析</strong>：我们可以从以上代码中发现，<code>validateProp</code>虽然说的是带有校验的功能，但它并不会抛出错误进而阻止<code>validateProp()</code>方法返回<code>value</code>，而是根据校验的过程中的不同情况尽可能的提示出很清晰的提示。实质上<code>validateProp()</code>方法最主要的还是返回<code>value</code>，同时也根据不同的<code>props</code>写法处理不同的情况。我们可以将<code>validateProp()</code>方法进行总结，它主要做如下几件事情：</p><ul><li>处理<code>Boolean</code>类型的<code>props</code>。</li><li>处理<code>default</code>默认数据。</li><li><code>props</code>断言。</li></ul><p>那么我们接下来将分别对这几件事情进行详细的描述。</p><h4 id="处理boolean类型" tabindex="-1"><a class="header-anchor" href="#处理boolean类型" aria-hidden="true">#</a> 处理Boolean类型</h4><p>我们先来看几个<code>props</code>传递<code>Boolean</code>的例子：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Component A</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fixed</span><span class="token operator">:</span> Boolean
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Component B</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fixed</span><span class="token operator">:</span> <span class="token punctuation">[</span>Boolean<span class="token punctuation">,</span> String<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Component C</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fixed</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后回到源码中处理<code>Boolean</code>类型<code>getTypeIndex</code>的地方，这个函数的代码如下：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getTypeIndex</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> expectedTypes</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>expectedTypes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isSameType</span><span class="token punctuation">(</span>expectedTypes<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> expectedTypes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameType</span><span class="token punctuation">(</span>expectedTypes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> i
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个函数的实现逻辑比较清晰：</p><ol><li>以<code>Component A</code>组件为例，它的<code>props</code>不是一个数组但却是<code>Boolean</code>类型，因此返回索引<code>0</code>。</li><li>以<code>Component B</code>组件为例，因为它的<code>props</code>是一个数组，所以要遍历这个数组，然后返回<code>Boolean</code>类型在数组中的索引<code>i</code>。</li><li>以<code>Component C</code>组件为例，虽然它是一个数组，但数组中没有任何元素，因此返回索引<code>-1</code>。</li></ol><p>在拿到<code>booleanIndex</code>后，我们需要走下面这段代码逻辑：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> booleanIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>booleanIndex <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>absent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// only cast empty string / same name to boolean if</span>
    <span class="token comment">// boolean has higher priority</span>
    <span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stringIndex <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> booleanIndex <span class="token operator">&lt;</span> stringIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码分析：</p><ul><li>在<code>if</code>条件判断中<code>absent</code>代表虽然我们在子组件中定义了<code>props</code>，但是父组件并没有传递任何值，然后<code>&amp;</code>条件又判断了子组件<code>props</code>有没有提供<code>default</code>默认值选项，如果没有，那么它的值只能为<code>false</code>。</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 父组件未传递fixed</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ParentComponent&#39;</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child-component /&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 子组件fixed值取false</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ChildComponent&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fixed</span><span class="token operator">:</span> Boolean
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在<code>else if</code>条件判断中，我们判断了两种特殊的<code>props</code>传递方式：</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Parent Component A</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ParentComponentA&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child-component fixed /&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// Parent Component B</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ParentComponentB&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child-component fixed=&quot;fixed&quot; /&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于第一个种情况<code>stringIndex</code>为<code>-1</code>，<code>booleanIndex</code>为<code>0</code>，因此<code>value</code>的值为<code>true</code>。对于第二种情况，则需要根据<code>props</code>的定义具体区分：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Child Component A</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ChildComponentA&#39;</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fixed</span><span class="token operator">:</span> <span class="token punctuation">[</span>Boolean<span class="token punctuation">,</span> String<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Child Component B</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ChildComponentB&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Boolean<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>对于<code>ChildComponentA</code>来说，由于<code>stringIndex</code>值为<code>1</code>，<code>booleanIndex</code>值为<code>0</code>，<code>booleanIndex &lt; stringIndex</code>因此我们可以认为<code>Boolean</code>具有更高的优先级，此时<code>value</code>的值为<code>true</code>。</li><li>对于<code>ChildComponentB</code>来说，由于<code>stringIndex</code>值为<code>0</code>，<code>booleanIndex</code>值为<code>1</code>，<code>stringIndex &lt; booleanIndex</code>因此我们可以认为<code>String</code>具有更高的优先级，此时<code>value</code>的值不处理。</li></ol><h4 id="处理default默认数据" tabindex="-1"><a class="header-anchor" href="#处理default默认数据" aria-hidden="true">#</a> 处理default默认数据</h4><p>处理完<code>Boolean</code>类型后，我们来处理默认值，既我们提到过的虽然子组件定义了<code>props</code>，但父组件没有传递的情况。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 父组件未传递fixed</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ParentComponent&#39;</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child-component /&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 子组件提供了default选项</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ChildComponent&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fixed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于以上案例会走如下代码的逻辑：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value <span class="token operator">=</span> <span class="token function">getPropDefaultValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPropDefaultValue</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component<span class="token punctuation">,</span> <span class="token literal-property property">prop</span><span class="token operator">:</span> PropOptions<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token comment">// no default, return undefined</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> def <span class="token operator">=</span> prop<span class="token punctuation">.</span>default
  <span class="token comment">// warn against non-factory defaults for Object &amp; Array</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">&#39;Invalid default value for prop &quot;&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;&quot;: &#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;Props with type Object/Array must use a factory function &#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;to return the default value.&#39;</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// the raw prop value was also undefined from previous render,</span>
  <span class="token comment">// return previous default value to avoid unnecessary watcher trigger</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">&amp;&amp;</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
    vm<span class="token punctuation">.</span>_props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> vm<span class="token punctuation">.</span>_props<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// call factory function for non-Function types</span>
  <span class="token comment">// a value is Function if its prototype is function even across different execution context</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> def <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">getType</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&#39;Function&#39;</span>
    <span class="token operator">?</span> <span class="token function">def</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> def
<span class="token punctuation">}</span>
</code></pre></div><p>代码分析：</p><ol><li>首先判断了子组件有没有提供<code>default</code>默认值选项，没有则直接返回<code>undefined</code>。</li><li>随后判断了<code>default</code>如果是引用类型，则提示必须把<code>default</code>写成一个函数，既：</li></ol><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// 必须写成</span>
<span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>最后再根据<code>default</code>的类型来取值，如果是函数类型则调用这个函数，如果不是函数类型则直接使用。</li><li>其中下面一段代码在这里我们并不会说明和分析它的具体作用，而是会在<code>props</code>更新章节来介绍。</li></ol><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">&amp;&amp;</span>
  vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
  vm<span class="token punctuation">.</span>_props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> vm<span class="token punctuation">.</span>_props<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="props断言" tabindex="-1"><a class="header-anchor" href="#props断言" aria-hidden="true">#</a> props断言</h4><p>最后我们来分析一下<code>props</code>断言。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">assertProp</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">prop</span><span class="token operator">:</span> PropOptions<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component<span class="token punctuation">,</span>
  <span class="token literal-property property">absent</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>required <span class="token operator">&amp;&amp;</span> absent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">&#39;Missing required prop: &quot;&#39;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>prop<span class="token punctuation">.</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> type <span class="token operator">=</span> prop<span class="token punctuation">.</span>type
  <span class="token keyword">let</span> valid <span class="token operator">=</span> <span class="token operator">!</span>type <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token boolean">true</span>
  <span class="token keyword">const</span> expectedTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      type <span class="token operator">=</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> type<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>valid<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> assertedType <span class="token operator">=</span> <span class="token function">assertType</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      expectedTypes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>assertedType<span class="token punctuation">.</span>expectedType <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
      valid <span class="token operator">=</span> assertedType<span class="token punctuation">.</span>valid
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token function">getInvalidTypeMessage</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expectedTypes<span class="token punctuation">)</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> validator <span class="token operator">=</span> prop<span class="token punctuation">.</span>validator
  <span class="token keyword">if</span> <span class="token punctuation">(</span>validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">validator</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&#39;Invalid prop: custom validator check failed for prop &quot;&#39;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#39;&quot;.&#39;</span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>assertProp</code>中我们有三种情况需要去断言：</p><ul><li><code>required</code>：如果子组件<code>props</code>提供了<code>required</code>选项，代表这个<code>props</code>必须在父组件中传递值，如果不传递则抛出错误信息<code>Missing required prop: fixed</code>。</li><li>对于定义了多个<code>type</code>的类型数组，则我们会遍历这个类型数组，只要当前<code>props</code>的类型和类型数组中某一个元素匹配则终止遍历。，否则抛出错误提示信息。</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Parent Component</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ParentComponent&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child-component :age=&quot;true&quot; /&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token comment">// Chil Component</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ChilComponent&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">[</span>Number<span class="token punctuation">,</span> String<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 报错：Invalid prop: type check failed for prop age，Expected Number, String，got with value true</span>
</code></pre></div><ul><li>用户自己提供的<code>validator</code>校验器我们也需要进行断言：</li></ul><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Parent Component</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ParentComponent&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;child-component :age=&quot;101&quot; /&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
<span class="token comment">// Chil Component</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;ChilComponent&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token function">validator</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value <span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&lt;=</span><span class="token number">100</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 报错：Invalid prop: custom validator check failed for prop age</span>
</code></pre></div><h2 id="props更新" tabindex="-1"><a class="header-anchor" href="#props更新" aria-hidden="true">#</a> props更新</h2><p>我们都知道子组件的<code>props</code>值来源于父组件，当父组件值更新时，子组件的值也会发生改变，同时触发子组件的重新渲染。我们先跳过父组件的具体编译逻辑，直接看父组件的值更新，改变子组件<code>props</code>值的步骤：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateChildComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">propsData</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">listeners</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">parentVnode</span><span class="token operator">:</span> MountedComponentVNode<span class="token punctuation">,</span>
  <span class="token literal-property property">renderChildren</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 省略代码</span>
  <span class="token comment">// update props</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>propsData <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props
    <span class="token keyword">const</span> propKeys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> key <span class="token operator">=</span> propKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">const</span> <span class="token literal-property property">propOptions</span><span class="token operator">:</span> any <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props <span class="token comment">// wtf flow?</span>
      props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment">// keep a copy of raw propsData</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">=</span> propsData
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码分析：</p><ol><li>以上<code>vm</code>实例为子组件，<code>propsData</code>为父组件中传递的<code>props</code>的值，而<code>_propKeys</code>是之前<code>props</code>初始化过程中缓存起来的所有的<code>props</code>的key。</li><li>在父组件值更新后，会通过遍历<code>propsKey</code>来重新对子组件<code>props</code>进行<strong>校验求值</strong>，最后赋值。</li></ol><p>以上代码就是子组件<code>props</code>更新的过程，在<code>props</code>更新后会进行子组件的重新渲染，这个重新渲染的过程分两种情况：</p><ul><li>普通<code>props</code>值被修改：当<code>props</code>值被修改后，其中有段代码<code>props[key] = validateProp(key, propOptions, propsData, vm)</code>根据响应式原理，会触发属性的<code>setter</code>，进而子组件可以重新渲染。</li><li>对象<code>props</code>内部属性变化：当这种情况发生时，并没有触发子组件<code>prop</code>的更新，但是在子组件渲染的时候读取到了<code>props</code>，因此会收集到这个<code>props</code>的<code>render watcher</code>，当对象<code>props</code>内部属性变化的时候，根据响应式原理依然会触发<code>setter</code>，进而子组件可以重新进行渲染。</li></ul><h2 id="toggleobserving作用" tabindex="-1"><a class="header-anchor" href="#toggleobserving作用" aria-hidden="true">#</a> toggleObserving作用</h2><p><code>toggleObserving</code>是定义在<code>src/core/observer/index.js</code>文件中的一个函数，其代码很简单：</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">let</span> <span class="token literal-property property">shouldObserve</span><span class="token operator">:</span> boolean <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">toggleObserving</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  shouldObserve <span class="token operator">=</span> value
<span class="token punctuation">}</span>
</code></pre></div><p>它的作用就是修改当前模块的<code>shouldObserve</code>变量，用来控制在<code>observe</code>的过程中是否需要把当前值变成一个<code>observer</code>对象。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">asRootData</span><span class="token operator">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> value <span class="token keyword">instanceof</span> <span class="token class-name">VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token literal-property property">ob</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">&#39;__ob__&#39;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>__ob__ <span class="token keyword">instanceof</span> <span class="token class-name">Observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> value<span class="token punctuation">.</span>__ob__
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
    shouldObserve <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token function">isServerRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">isExtensible</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span>value<span class="token punctuation">.</span>_isVue
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>asRootData <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ob<span class="token punctuation">.</span>vmCount<span class="token operator">++</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ob
<span class="token punctuation">}</span>
</code></pre></div><p>接下来我们来分析，在处理<code>props</code>的过程中，什么时候<code>toggleObserving(true)</code>，什么时候<code>toggleObserving(false)</code>以及为什么需要这样处理？</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component<span class="token punctuation">,</span> <span class="token literal-property property">propsOptions</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 省略defineReactive的过程</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>props</code>初始化的时候：<br> 我们可以看到在最开始判断了当为非根实例(子组件)的时候，进行了<code>toggleObserving(false)</code>的操作，这样做的目的是因为：当非根实例的时候，组件的<code>props</code>来自于父组件。当<code>props</code>为对象或者数组时，根据响应式原理，我们会递归遍历子属性然后进行<code>observe(val)</code>，而正是因为<code>props</code>来源于父组件，这个过程其实已经在父组件执行过了，如果不做任何限制，那么会在子组件中又重复一次这样的过程，因此这里需要<code>toggleObserving(false)</code>，用来避免递归<code>props</code>子属性的情况，这属于响应式优化的一种手段。在代码最后，又调用了<code>toggleObserving(true)</code>，把<code>shouldObserve</code>的值还原。</p><p><code>props</code>校验的时候：<br> 我们先来看<code>props</code>提供了<code>default</code>默认值，且默认值返回了对象或者数组。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">point</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于以上<code>point</code>和<code>list</code>取默认值的情况，这个时候的<code>props</code>值与父组件没有关系，那么这个时候我们需要<code>toggleObserving(true)</code>，在<code>observe</code>后再把<code>shouldObserve</code>变量设置为原来的值。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateProp</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 省略代码</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token function">getPropDefaultValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> prevShouldObserve <span class="token operator">=</span> shouldObserve 
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span>prevShouldObserve<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>props</code>更新的时候：<br> 当父组件更新的时候，会调用<code>updateChildComponent()</code>方法，用来更新子组件的<code>props</code>值，这个时候其实和<code>props</code>初始化的逻辑一样，我们同样不需要对指向父组件的对象或数组<code>props</code>进行递归子属性<code>observe</code>的过程，因此这里需要执行<code>toggleObserving(false)</code>。</p><div class="language-javascript" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateChildComponent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// update props</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>propsData <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props
    <span class="token keyword">const</span> propKeys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> key <span class="token operator">=</span> propKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">const</span> <span class="token literal-property property">propOptions</span><span class="token operator">:</span> any <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props <span class="token comment">// wtf flow?</span>
      props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">=</span> propsData
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="整体流程图" tabindex="-1"><a class="header-anchor" href="#整体流程图" aria-hidden="true">#</a> 整体流程图</h2><p>在分析完以上所有与<code>props</code>相关的逻辑后，我们可以总结如下流程图。</p><div style="text-align:center;"><img src="/blog/assets/props-f4eacb89.png"></div></div><!--[--><!--[--><div id="comment" class="giscus-wrapper input-top layout-comment" style="display:block;" data-v-e3e878f2><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: why583440138@gmail.com">wangtunan</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/blog/vueAnalysis/reactive/prepare.html" class="" aria-label="前置核心概念"><!--[--><!--]--> 前置核心概念 <!--[--><!--]--></a></span><span class="next"><a href="/blog/vueAnalysis/reactive/methods.html" class="" aria-label="methods处理"><!--[--><!--]--> methods处理 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-c9f86c19.js" defer></script>
  </body>
</html>
