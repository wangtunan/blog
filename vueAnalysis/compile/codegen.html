<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.21" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/blog/icon.png"><title>codegen代码生成 | 汪图南</title><meta name="description" content="汪图南的个人博客">
    <link rel="preload" href="/blog/assets/style-CvKI6irq.css" as="style"><link rel="stylesheet" href="/blog/assets/style-CvKI6irq.css">
    <link rel="modulepreload" href="/blog/assets/app-BfeJmovj.js"><link rel="modulepreload" href="/blog/assets/codegen.html-DFqgY3PZ.js">
    <link rel="prefetch" href="/blog/assets/index.html-CidyPzm4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-qYbX2Goh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BprTgYNn.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTeoCwrj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CFiW3oez.js" as="script"><link rel="prefetch" href="/blog/assets/vueTest.html-DTnwxsK0.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-BcjqXyB9.js" as="script"><link rel="prefetch" href="/blog/assets/challenge.html-lDdSEkJk.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C01UOmT3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Dn2O0yzj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-t5dimH9O.js" as="script"><link rel="prefetch" href="/blog/assets/algorithm.html-Csv1ng5s.js" as="script"><link rel="prefetch" href="/blog/assets/es6.html-8eWaUCpN.js" as="script"><link rel="prefetch" href="/blog/assets/know-down.html-BMrgyeHG.js" as="script"><link rel="prefetch" href="/blog/assets/know-up.html-dcwoRFjZ.js" as="script"><link rel="prefetch" href="/blog/assets/red-book.html-CY0ezMq1.js" as="script"><link rel="prefetch" href="/blog/assets/vue.html-CWR4NIBE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-265Zudvh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BckVuhI8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C41RR8NR.js" as="script"><link rel="prefetch" href="/blog/assets/gin.html-BPy12Yxr.js" as="script"><link rel="prefetch" href="/blog/assets/gorm.html-BGw2P4Cu.js" as="script"><link rel="prefetch" href="/blog/assets/mod.html-a_r61f9r.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QjHR7lGU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BJ0DOIJJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2iMclHGS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DrWZUK70.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-LqFrJt21.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QAe7G2Xi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DBlu-wKi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-m_76Txsu.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CNPodau0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CVThgGEf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C2JHbduF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DYhO_dd9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CERQM628.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BpUBAWq5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-irraTmvI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DjnAQJsz.js" as="script"><link rel="prefetch" href="/blog/assets/compileToFunctions.html-Ur8EGbnF.js" as="script"><link rel="prefetch" href="/blog/assets/optimize.html-BIUlwRWu.js" as="script"><link rel="prefetch" href="/blog/assets/parse.html-Bl15TeTZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BrstS7Cg.js" as="script"><link rel="prefetch" href="/blog/assets/async.html-C9V9gI1O.js" as="script"><link rel="prefetch" href="/blog/assets/createComponent.html-Cl89f6HQ.js" as="script"><link rel="prefetch" href="/blog/assets/createElement.html-CE3G2sO_.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-CG5hZYuL.js" as="script"><link rel="prefetch" href="/blog/assets/merge.html-DOKB4WJP.js" as="script"><link rel="prefetch" href="/blog/assets/mount.html-DaLNT8dv.js" as="script"><link rel="prefetch" href="/blog/assets/patch.html-CEo2mDe_.js" as="script"><link rel="prefetch" href="/blog/assets/register.html-CYMQ8Q4J.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-Col8Y5BY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Hmai-mT6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BOOYYzsF.js" as="script"><link rel="prefetch" href="/blog/assets/diff.html-DbpTvBcc.js" as="script"><link rel="prefetch" href="/blog/assets/vnode.html-Bmd0cs66.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BIb8Aa_H.js" as="script"><link rel="prefetch" href="/blog/assets/events.html-jkvmm633.js" as="script"><link rel="prefetch" href="/blog/assets/global.html-DKnsNGFH.js" as="script"><link rel="prefetch" href="/blog/assets/init.html-CBPQCY8s.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-DnGxoRZk.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-BXl8YF4L.js" as="script"><link rel="prefetch" href="/blog/assets/state.html-B93rJTs6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B81El4Qq.js" as="script"><link rel="prefetch" href="/blog/assets/directive.html-z6HqYGSu.js" as="script"><link rel="prefetch" href="/blog/assets/event.html-k-vqBqdI.js" as="script"><link rel="prefetch" href="/blog/assets/filter.html-Dv_vQGtI.js" as="script"><link rel="prefetch" href="/blog/assets/keep-alive.html-D7-T-WTv.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-BapdxBWy.js" as="script"><link rel="prefetch" href="/blog/assets/slot.html-7q7RfNp3.js" as="script"><link rel="prefetch" href="/blog/assets/transition-group.html-RqFe0HXN.js" as="script"><link rel="prefetch" href="/blog/assets/transition.html-CkViEaaN.js" as="script"><link rel="prefetch" href="/blog/assets/vmodel.html-DDFLtjn1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CpQsfyhv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1b58dUkG.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-Cf_aXgOt.js" as="script"><link rel="prefetch" href="/blog/assets/computed.html-CfSQpRW4.js" as="script"><link rel="prefetch" href="/blog/assets/data.html-jDIU-GEg.js" as="script"><link rel="prefetch" href="/blog/assets/dep.html-P_YXttGl.js" as="script"><link rel="prefetch" href="/blog/assets/methods.html-DnBzoRqF.js" as="script"><link rel="prefetch" href="/blog/assets/nexttick.html-C8xEtDyR.js" as="script"><link rel="prefetch" href="/blog/assets/notify.html-qtNeNiAV.js" as="script"><link rel="prefetch" href="/blog/assets/prepare.html-DNGLnsrO.js" as="script"><link rel="prefetch" href="/blog/assets/problem.html-BhBUPBgE.js" as="script"><link rel="prefetch" href="/blog/assets/props.html-pXfE2-lS.js" as="script"><link rel="prefetch" href="/blog/assets/reactive.html-DodIvYSF.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-BULRA0iO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BkBhJ-rn.js" as="script"><link rel="prefetch" href="/blog/assets/vue.html-6jqxgIiq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Q3KEfxG6.js" as="script"><link rel="prefetch" href="/blog/assets/change.html-BA-bLlGY.js" as="script"><link rel="prefetch" href="/blog/assets/components.html-BjKgIGhw.js" as="script"><link rel="prefetch" href="/blog/assets/hooks.html-DaL6eYK_.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-Bi-fAaPM.js" as="script"><link rel="prefetch" href="/blog/assets/matcher.html-BV-Sbh8s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTMx28yg.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-DcQZ1fNc.js" as="script"><link rel="prefetch" href="/blog/assets/init.html-Da32hDfK.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-Dnx1B-9f.js" as="script"><link rel="prefetch" href="/blog/assets/utils.html-Ba_VrhkO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C_InjNZM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D5QNby-n.js" as="script"><link rel="prefetch" href="/blog/assets/createApp.html-BoiGZ5-L.js" as="script"><link rel="prefetch" href="/blog/assets/lifecycle.html-BLO98bcz.js" as="script"><link rel="prefetch" href="/blog/assets/mount.html-CUskDUP0.js" as="script"><link rel="prefetch" href="/blog/assets/register.html-DOG_mZwb.js" as="script"><link rel="prefetch" href="/blog/assets/render.html-B76-aHTW.js" as="script"><link rel="prefetch" href="/blog/assets/setup.html-BKtRzsty.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D-jvuZIp.js" as="script"><link rel="prefetch" href="/blog/assets/optimization.html-BCNZidqE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bk4nM7iW.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BsjeIJnk.js" as="script"><link rel="prefetch" href="/blog/assets/base.html-CYdAQOjn.js" as="script"><link rel="prefetch" href="/blog/assets/computed.html-Dk7RRYxt.js" as="script"><link rel="prefetch" href="/blog/assets/reactive.html-K4s_j-yn.js" as="script"><link rel="prefetch" href="/blog/assets/readonly.html-BysPSbsQ.js" as="script"><link rel="prefetch" href="/blog/assets/ref.html-BGpL_JDx.js" as="script"><link rel="prefetch" href="/blog/assets/track.html-CLm_yubL.js" as="script"><link rel="prefetch" href="/blog/assets/trigger.html-Dx8-ENTT.js" as="script"><link rel="prefetch" href="/blog/assets/watch.html-B6GdrwSa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CjLVYUwL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Zk9TQlHV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C7kZNj1I.js" as="script"><link rel="prefetch" href="/blog/assets/advanced.html-CKVqEZ3d.js" as="script"><link rel="prefetch" href="/blog/assets/case.html-DJmGT7T6.js" as="script"><link rel="prefetch" href="/blog/assets/core.html-DCt1FaTF.js" as="script"><link rel="prefetch" href="/blog/assets/install.html-Cj_5DWP1.js" as="script"><link rel="prefetch" href="/blog/assets/loader.html-D8k7J42h.js" as="script"><link rel="prefetch" href="/blog/assets/optimization.html-BcJJJIXl.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-DGGtAoxB.js" as="script"><link rel="prefetch" href="/blog/assets/source.html-lvZAmKZQ.js" as="script"><link rel="prefetch" href="/blog/assets/start.html-NRThGIv9.js" as="script"><link rel="prefetch" href="/blog/assets/static.html-BdndtrS5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DVagqPWd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D5X584cJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CzME43xZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html--SQEkpWD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-wyof_5QD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D3KuzHqg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BZ9sm4XZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-VpL_NC3x.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ChyiSScD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C3SlflWU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B8vIwTLd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CbCxB407.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DxSJ6A8a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DObuaMrc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CmDG5q6F.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DIYnAXae.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D6e3Xzuk.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-u4bLQNG9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-MsTKd2c1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CxO89V28.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BQhSO3Ik.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BvzJ8LIo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DeV-zpb3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CDRhVU3m.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BWs_ybHH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B5Ag_xBG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DlqJdjMU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BxO2YOu-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BAYBLXAC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C4nGrXJo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DiQutppF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CvCSPgIt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B0AnB8rl.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-UL2RnK1c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DEKVCgSt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-D7Usv3PZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-XHsvAcxl.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BixQIGZw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BkNNC5wu.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CWVtcxD0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-krv8QBuc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BvkyeQmh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-nghAIo-d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BmqbSLOT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CsaXubeE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BSF0G4r4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BJXoKbAd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4A-XqnUO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CmC6UTdk.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-D3lQj0vl.js" as="script"><link rel="prefetch" href="/blog/assets/leetcodeLink-DmguFvJB.js" as="script"><link rel="prefetch" href="/blog/assets/linkAndSolution-CNEV_Ohp.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-1zs_z9NH.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container data-v-ad8a078f><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><!----><span class="vp-site-name" aria-hidden="true">汪图南</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/interview/" aria-label="前端面试之道"><!--[--><!--[--><!--]--><!--]-->前端面试之道<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>打包工具</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/webpack/webpack/" aria-label="Webpack"><!--[--><!--[--><!--]--><!--]-->Webpack<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/rollup/" aria-label="Rollup"><!--[--><!--[--><!--]--><!--]-->Rollup<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>TypeScript</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/typescript/base/" aria-label="TypeScript基础"><!--[--><!--[--><!--]--><!--]-->TypeScript基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/typescript/challenge/" aria-label="TypeScript类型挑战"><!--[--><!--[--><!--]--><!--]-->TypeScript类型挑战<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>CSS预编译器</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/cssPrecompiler/sass/" aria-label="SASS"><!--[--><!--[--><!--]--><!--]-->SASS<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>自动化测试</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/test/vueTest/" aria-label="Vue应用测试"><!--[--><!--[--><!--]--><!--]-->Vue应用测试<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/vueAnalysis/introduction/" aria-label="Vue2.0源码分析"><!--[--><!--[--><!--]--><!--]-->Vue2.0源码分析<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/vueNextAnalysis/introduction/" aria-label="Vue3.0源码分析"><!--[--><!--[--><!--]--><!--]-->Vue3.0源码分析<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/algorithm/base/introduction/" aria-label="数据结构和算法(基础)"><!--[--><!--[--><!--]--><!--]-->数据结构和算法(基础)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/algorithm/leetcode/introduction/" aria-label="LeetCode(刷题)"><!--[--><!--[--><!--]--><!--]-->LeetCode(刷题)<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Python技术栈"><span class="title">Python技术栈</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Python技术栈"><span class="title">Python技术栈</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/python/base/" aria-label="快速入门"><!--[--><!--[--><!--]--><!--]-->快速入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/python/advanced/" aria-label="高级技巧"><!--[--><!--[--><!--]--><!--]-->高级技巧<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="LLM"><span class="title">LLM</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="LLM"><span class="title">LLM</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>RAG</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/rag/base/" aria-label="RAG基础"><!--[--><!--[--><!--]--><!--]-->RAG基础<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="书籍"><span class="title">书籍</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="书籍"><span class="title">书籍</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>JavaScript书籍</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/know-up/" aria-label="你不知道的JavaScript(上)"><!--[--><!--[--><!--]--><!--]-->你不知道的JavaScript(上)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/know-down/" aria-label="你不知道的JavaScript(中下)"><!--[--><!--[--><!--]--><!--]-->你不知道的JavaScript(中下)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/algorithm/" aria-label="JavaScript数据结构和算法"><!--[--><!--[--><!--]--><!--]-->JavaScript数据结构和算法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/designPattern/" aria-label="JavaScript设计模式与开发实践"><!--[--><!--[--><!--]--><!--]-->JavaScript设计模式与开发实践<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/es6/" aria-label="深入理解ES6"><!--[--><!--[--><!--]--><!--]-->深入理解ES6<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Git书籍</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/git/" aria-label="精通Git"><!--[--><!--[--><!--]--><!--]-->精通Git<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/wangtunan/blog" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/interview/" aria-label="前端面试之道"><!--[--><!--[--><!--]--><!--]-->前端面试之道<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端技术栈"><span class="title">前端技术栈</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>打包工具</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/webpack/webpack/" aria-label="Webpack"><!--[--><!--[--><!--]--><!--]-->Webpack<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/rollup/" aria-label="Rollup"><!--[--><!--[--><!--]--><!--]-->Rollup<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>TypeScript</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/typescript/base/" aria-label="TypeScript基础"><!--[--><!--[--><!--]--><!--]-->TypeScript基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/typescript/challenge/" aria-label="TypeScript类型挑战"><!--[--><!--[--><!--]--><!--]-->TypeScript类型挑战<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>CSS预编译器</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/cssPrecompiler/sass/" aria-label="SASS"><!--[--><!--[--><!--]--><!--]-->SASS<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>自动化测试</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/test/vueTest/" aria-label="Vue应用测试"><!--[--><!--[--><!--]--><!--]-->Vue应用测试<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Vue源码分析"><span class="title">Vue源码分析</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/vueAnalysis/introduction/" aria-label="Vue2.0源码分析"><!--[--><!--[--><!--]--><!--]-->Vue2.0源码分析<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/vueNextAnalysis/introduction/" aria-label="Vue3.0源码分析"><!--[--><!--[--><!--]--><!--]-->Vue3.0源码分析<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/algorithm/base/introduction/" aria-label="数据结构和算法(基础)"><!--[--><!--[--><!--]--><!--]-->数据结构和算法(基础)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/algorithm/leetcode/introduction/" aria-label="LeetCode(刷题)"><!--[--><!--[--><!--]--><!--]-->LeetCode(刷题)<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Python技术栈"><span class="title">Python技术栈</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Python技术栈"><span class="title">Python技术栈</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/python/base/" aria-label="快速入门"><!--[--><!--[--><!--]--><!--]-->快速入门<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/blog/python/advanced/" aria-label="高级技巧"><!--[--><!--[--><!--]--><!--]-->高级技巧<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="LLM"><span class="title">LLM</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="LLM"><span class="title">LLM</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>RAG</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/rag/base/" aria-label="RAG基础"><!--[--><!--[--><!--]--><!--]-->RAG基础<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="书籍"><span class="title">书籍</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="书籍"><span class="title">书籍</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>JavaScript书籍</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/know-up/" aria-label="你不知道的JavaScript(上)"><!--[--><!--[--><!--]--><!--]-->你不知道的JavaScript(上)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/know-down/" aria-label="你不知道的JavaScript(中下)"><!--[--><!--[--><!--]--><!--]-->你不知道的JavaScript(中下)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/algorithm/" aria-label="JavaScript数据结构和算法"><!--[--><!--[--><!--]--><!--]-->JavaScript数据结构和算法<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/designPattern/" aria-label="JavaScript设计模式与开发实践"><!--[--><!--[--><!--]--><!--]-->JavaScript设计模式与开发实践<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/javascript/es6/" aria-label="深入理解ES6"><!--[--><!--[--><!--]--><!--]-->深入理解ES6<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Git书籍</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/books/git/" aria-label="精通Git"><!--[--><!--[--><!--]--><!--]-->精通Git<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/wangtunan/blog" aria-label="Github" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Github<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">介绍 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/introduction/" aria-label="介绍和参考"><!--[--><!--[--><!--]--><!--]-->介绍和参考<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">源码目录设计和架构设计 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/design/" aria-label="设计"><!--[--><!--[--><!--]--><!--]-->设计<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Rollup构建版本 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/rollup/" aria-label="Rollup基础知识"><!--[--><!--[--><!--]--><!--]-->Rollup基础知识<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/rollup/vue.html" aria-label="Vue中的Rollup构建"><!--[--><!--[--><!--]--><!--]-->Vue中的Rollup构建<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">从入口到构造函数整体流程 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/" aria-label="整体流程"><!--[--><!--[--><!--]--><!--]-->整体流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/global.html" aria-label="initGlobalAPI流程"><!--[--><!--[--><!--]--><!--]-->initGlobalAPI流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/init.html" aria-label="initMixin流程"><!--[--><!--[--><!--]--><!--]-->initMixin流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/state.html" aria-label="stateMixin流程"><!--[--><!--[--><!--]--><!--]-->stateMixin流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/events.html" aria-label="eventsMixin流程"><!--[--><!--[--><!--]--><!--]-->eventsMixin流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/lifecycle.html" aria-label="lifecycleMixin流程"><!--[--><!--[--><!--]--><!--]-->lifecycleMixin流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/entry/render.html" aria-label="renderMixin流程"><!--[--><!--[--><!--]--><!--]-->renderMixin流程<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">响应式原理 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/" aria-label="介绍"><!--[--><!--[--><!--]--><!--]-->介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/prepare.html" aria-label="前置核心概念"><!--[--><!--[--><!--]--><!--]-->前置核心概念<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/props.html" aria-label="props处理"><!--[--><!--[--><!--]--><!--]-->props处理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/methods.html" aria-label="methods处理"><!--[--><!--[--><!--]--><!--]-->methods处理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/data.html" aria-label="data处理"><!--[--><!--[--><!--]--><!--]-->data处理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/computed.html" aria-label="computed处理"><!--[--><!--[--><!--]--><!--]-->computed处理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/watch.html" aria-label="watch处理"><!--[--><!--[--><!--]--><!--]-->watch处理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/reactive.html" aria-label="深入响应式原理"><!--[--><!--[--><!--]--><!--]-->深入响应式原理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/dep.html" aria-label="依赖收集"><!--[--><!--[--><!--]--><!--]-->依赖收集<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/notify.html" aria-label="派发更新"><!--[--><!--[--><!--]--><!--]-->派发更新<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/nexttick.html" aria-label="nextTick实现原理"><!--[--><!--[--><!--]--><!--]-->nextTick实现原理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/problem.html" aria-label="变化侦测注意事项"><!--[--><!--[--><!--]--><!--]-->变化侦测注意事项<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/reactive/api.html" aria-label="变化侦测API实现"><!--[--><!--[--><!--]--><!--]-->变化侦测API实现<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">虚拟DOM和VNode <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/dom/" aria-label="虚拟DOM"><!--[--><!--[--><!--]--><!--]-->虚拟DOM<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/dom/vnode.html" aria-label="VNode介绍"><!--[--><!--[--><!--]--><!--]-->VNode介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/dom/diff.html" aria-label="Diff算法"><!--[--><!--[--><!--]--><!--]-->Diff算法<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">组件化 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/" aria-label="介绍"><!--[--><!--[--><!--]--><!--]-->介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/mount.html" aria-label="$mount方法"><!--[--><!--[--><!--]--><!--]-->$mount方法<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/render.html" aria-label="render和renderProxy"><!--[--><!--[--><!--]--><!--]-->render和renderProxy<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/createElement.html" aria-label="createElement"><!--[--><!--[--><!--]--><!--]-->createElement<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/createComponent.html" aria-label="createComponent"><!--[--><!--[--><!--]--><!--]-->createComponent<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/merge.html" aria-label="合并策略"><!--[--><!--[--><!--]--><!--]-->合并策略<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/patch.html" aria-label="update和patch"><!--[--><!--[--><!--]--><!--]-->update和patch<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/lifecycle.html" aria-label="组件生命周期"><!--[--><!--[--><!--]--><!--]-->组件生命周期<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/component/register.html" aria-label="组件注册"><!--[--><!--[--><!--]--><!--]-->组件注册<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">编译原理 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item" href="/blog/vueAnalysis/compile/" aria-label="介绍"><!--[--><!--[--><!--]--><!--]-->介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/compile/compileToFunctions.html" aria-label="compileToFunctions"><!--[--><!--[--><!--]--><!--]-->compileToFunctions<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/compile/parse.html" aria-label="parse模板解析"><!--[--><!--[--><!--]--><!--]-->parse模板解析<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/compile/optimize.html" aria-label="optimize优化"><!--[--><!--[--><!--]--><!--]-->optimize优化<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/blog/vueAnalysis/compile/codegen.html" aria-label="codegen代码生成"><!--[--><!--[--><!--]--><!--]-->codegen代码生成<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">扩展 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/" aria-label="扩展"><!--[--><!--[--><!--]--><!--]-->扩展<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/directive.html" aria-label="directive指令"><!--[--><!--[--><!--]--><!--]-->directive指令<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/filter.html" aria-label="filter过滤器"><!--[--><!--[--><!--]--><!--]-->filter过滤器<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/event.html" aria-label="event事件处理"><!--[--><!--[--><!--]--><!--]-->event事件处理<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/vmodel.html" aria-label="v-model"><!--[--><!--[--><!--]--><!--]-->v-model<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/slot.html" aria-label="插槽"><!--[--><!--[--><!--]--><!--]-->插槽<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/keep-alive.html" aria-label="Keep-Alive"><!--[--><!--[--><!--]--><!--]-->Keep-Alive<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/transition.html" aria-label="Transition"><!--[--><!--[--><!--]--><!--]-->Transition<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/transition-group.html" aria-label="Transition-Group"><!--[--><!--[--><!--]--><!--]-->Transition-Group<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/expand/plugin.html" aria-label="Vue.use插件机制"><!--[--><!--[--><!--]--><!--]-->Vue.use插件机制<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Vue-Router <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/router/" aria-label="介绍"><!--[--><!--[--><!--]--><!--]-->介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/router/install.html" aria-label="路由安装"><!--[--><!--[--><!--]--><!--]-->路由安装<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/router/matcher.html" aria-label="matcher介绍"><!--[--><!--[--><!--]--><!--]-->matcher介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/router/change.html" aria-label="路由切换"><!--[--><!--[--><!--]--><!--]-->路由切换<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/router/components.html" aria-label="内置组件"><!--[--><!--[--><!--]--><!--]-->内置组件<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/router/hooks.html" aria-label="路由hooks钩子函数"><!--[--><!--[--><!--]--><!--]-->路由hooks钩子函数<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Vuex <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/vuex/" aria-label="介绍"><!--[--><!--[--><!--]--><!--]-->介绍<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/vuex/install.html" aria-label="Vuex安装"><!--[--><!--[--><!--]--><!--]-->Vuex安装<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/vuex/init.html" aria-label="Vuex初始化"><!--[--><!--[--><!--]--><!--]-->Vuex初始化<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/vuex/utils.html" aria-label="Vuex辅助API"><!--[--><!--[--><!--]--><!--]-->Vuex辅助API<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/blog/vueAnalysis/vuex/api.html" aria-label="Store实例API"><!--[--><!--[--><!--]--><!--]-->Store实例API<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="codegen代码生成" tabindex="-1"><a class="header-anchor" href="#codegen代码生成"><span>codegen代码生成</span></a></h1><p>在<code>optimize</code>优化章节介绍完毕以后，我们来到了编译的最后一步：<code>codegen</code>代码生成。</p><p><code>codegen</code>代码生成阶段的逻辑相对来说还是比较多的，在这一节我们尽可能的分析常见的使用场景，例如：对<code>v-for</code>、<code>v-if/v-else</code>以及<code>v-for</code>等场景代码生成流程的分析。</p><p>在<code>baseCompile</code>方法中，我们可以看到在<code>parse</code>和<code>optimize</code>这两个主要流程之后，最后一步<code>codegen</code>的过程：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> generate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./codegen/index&#39;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">baseCompile</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">template</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">options</span><span class="token operator">:</span> CompilerOptions</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> CompiledResult <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>optimize <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">optimize</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> options<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    ast<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">render</span><span class="token operator">:</span> code<span class="token punctuation">.</span>render<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> code<span class="token punctuation">.</span>staticRenderFns</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="generate" tabindex="-1"><a class="header-anchor" href="#generate"><span>generate</span></a></h2><p>在<code>baseCompile</code>方法中，<code>codegen</code>负责将优化好的<code>AST</code>树形结构转换成可执行代码，其中最重要的是<code>code.render</code>。<code>generate</code>方法就是用来负责处理这个过程的，它是从<code>src/compiler/codegen/index.js</code>文件中引入的，其代码如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">ast</span><span class="token operator">:</span> ASTElement <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">options</span><span class="token operator">:</span> CompilerOptions</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> CodegenResult <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CodegenState</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> code <span class="token operator">=</span> ast <span class="token operator">?</span> <span class="token function">genElement</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&#39;_c(&quot;div&quot;)&#39;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> state<span class="token punctuation">.</span>staticRenderFns</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>generate</code>方法中它首先判断了<code>ast</code>，如果没有<code>ast</code>，则<code>code</code>赋值为<code>_c(&quot;div&quot;)</code>，如果有则调用<code>genElement</code>方法。在其返回对象的<code>render</code>属性中，它使用<code>with</code>把我们的代码进行了包裹。在<code>compileToFunctions</code>章节中，我们介绍过它会使用<code>new Function</code>的形式把字符串代码转换成真正的<code>Function</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">createFunction</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> errors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> err<span class="token punctuation">,</span> code <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> noop</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 转换前</span></span>
<span class="line"><span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token string">&#39;with(this){return _c(&quot;div&quot;)}&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 转换后</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还记得<code>_c</code>是什么吗？，<code>_c</code>是在<code>initRender</code>中定义的一个方法：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">vm<span class="token punctuation">.</span><span class="token function-variable function">_c</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在<code>codegen</code>代码生成阶段，我们会接触到各种类似命名的函数，它们都是辅助函数，我们可以在<code>src/core/instance/render-helpers/index.js</code>文件中找到：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">installRenderHelpers</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  target<span class="token punctuation">.</span>_o <span class="token operator">=</span> markOnce</span>
<span class="line">  target<span class="token punctuation">.</span>_n <span class="token operator">=</span> toNumber</span>
<span class="line">  target<span class="token punctuation">.</span>_s <span class="token operator">=</span> toString</span>
<span class="line">  target<span class="token punctuation">.</span>_l <span class="token operator">=</span> renderList</span>
<span class="line">  target<span class="token punctuation">.</span>_t <span class="token operator">=</span> renderSlot</span>
<span class="line">  target<span class="token punctuation">.</span>_q <span class="token operator">=</span> looseEqual</span>
<span class="line">  target<span class="token punctuation">.</span>_i <span class="token operator">=</span> looseIndexOf</span>
<span class="line">  target<span class="token punctuation">.</span>_m <span class="token operator">=</span> renderStatic</span>
<span class="line">  target<span class="token punctuation">.</span>_f <span class="token operator">=</span> resolveFilter</span>
<span class="line">  target<span class="token punctuation">.</span>_k <span class="token operator">=</span> checkKeyCodes</span>
<span class="line">  target<span class="token punctuation">.</span>_b <span class="token operator">=</span> bindObjectProps</span>
<span class="line">  target<span class="token punctuation">.</span>_v <span class="token operator">=</span> createTextVNode</span>
<span class="line">  target<span class="token punctuation">.</span>_e <span class="token operator">=</span> createEmptyVNode</span>
<span class="line">  target<span class="token punctuation">.</span>_u <span class="token operator">=</span> resolveScopedSlots</span>
<span class="line">  target<span class="token punctuation">.</span>_g <span class="token operator">=</span> bindObjectListeners</span>
<span class="line">  target<span class="token punctuation">.</span>_d <span class="token operator">=</span> bindDynamicKeys</span>
<span class="line">  target<span class="token punctuation">.</span>_p <span class="token operator">=</span> prependModifier</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的辅助函数有很多，我们来重点说明几个最常用的：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">installRenderHelpers</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  target<span class="token punctuation">.</span>_s <span class="token operator">=</span> toString          <span class="token comment">// 转字符串</span></span>
<span class="line">  target<span class="token punctuation">.</span>_l <span class="token operator">=</span> renderList        <span class="token comment">// 处理v-for列表</span></span>
<span class="line">  target<span class="token punctuation">.</span>_t <span class="token operator">=</span> renderSlot        <span class="token comment">// 处理插槽</span></span>
<span class="line">  target<span class="token punctuation">.</span>_m <span class="token operator">=</span> renderStatic      <span class="token comment">// 处理静态节点</span></span>
<span class="line">  target<span class="token punctuation">.</span>_f <span class="token operator">=</span> resolveFilter     <span class="token comment">// 处理过滤器</span></span>
<span class="line">  target<span class="token punctuation">.</span>_v <span class="token operator">=</span> createTextVNode   <span class="token comment">// 创建文本VNode</span></span>
<span class="line">  target<span class="token punctuation">.</span>_e <span class="token operator">=</span> createEmptyVNode  <span class="token comment">// 创建空VNode</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="genelement" tabindex="-1"><a class="header-anchor" href="#genelement"><span>genElement</span></a></h2><p>在<code>generate</code>方法中，它通过调用<code>genElement</code>来返回一个对象，我们来看一下这个方法的定义：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genElement</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    el<span class="token punctuation">.</span>pre <span class="token operator">=</span> el<span class="token punctuation">.</span>pre <span class="token operator">||</span> el<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>pre</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>staticRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>staticProcessed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genStatic</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>once <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>onceProcessed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genOnce</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>for <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>forProcessed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genFor</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>if <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>ifProcessed<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genIf</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&#39;template&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>slotTarget <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>pre<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;void 0&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>tag <span class="token operator">===</span> <span class="token string">&#39;slot&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genSlot</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// component or element</span></span>
<span class="line">    <span class="token keyword">let</span> code</span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      code <span class="token operator">=</span> <span class="token function">genComponent</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>component<span class="token punctuation">,</span> el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> data</span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>plain <span class="token operator">||</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>pre <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">.</span><span class="token function">maybeComponent</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        data <span class="token operator">=</span> <span class="token function">genData</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>inlineTemplate <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">      code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">        data <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// data</span></span>
<span class="line">      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">        children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// children</span></span>
<span class="line">      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// module transforms</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> state<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      code <span class="token operator">=</span> state<span class="token punctuation">.</span>transforms<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> code<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> code</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以在<code>genElement</code>方法中清晰的看到，它会根据<code>ast</code>属性的不同来分别调用不同的代码生成函数。例如：<code>genStatic</code>用来处理生成静态节点的、<code>genFor</code>用来处理<code>v-for</code>循环的，<code>genChildren</code>用来处理子节点的以及<code>genComponent</code>用来处理组件的。</p><p>下一步，我们的目标是对这些不同的代码生成函数来进行分析，同时由于<code>codegen</code>代码生成的逻辑相对来说还是比较多的，因此我们只介绍最常见的几种。</p><h2 id="genstatic" tabindex="-1"><a class="header-anchor" href="#genstatic"><span>genStatic</span></a></h2><p>在之前的<code>optimize</code>章节中，我们分析过是否为静态根节点的条件，假设我们有以下<code>template</code>：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>根据之前的分析过程，我们知道<code>div</code>节点会被标记为<code>staticRoot</code>静态根节点。在第一次执行<code>genElement</code>方法的时候，因为<code>staticRoot</code>为<code>true</code>，<code>staticProcessed</code>为<code>false</code>，因此会调用<code>genStatic</code>方法。接下来，我们来看一下<code>genStatic</code>方法的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">genStatic</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  el<span class="token punctuation">.</span>staticProcessed <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token comment">// ...省略pre相关</span></span>
<span class="line">  state<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></span>
<span class="line">   <span class="token comment">// ...省略pre相关</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_m(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">    state<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span></span>
<span class="line">  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">    el<span class="token punctuation">.</span>staticInFor <span class="token operator">?</span> <span class="token string">&#39;,true&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>genStatic</code>方法的最开始，它首先对<code>staticProcessed</code>赋值为<code>true</code>，这样做是为了防止在递归调用<code>genElement</code>方法的过程中，重复调用<code>genStatic</code>。接着，它递归调用<code>genElement</code>来处理<code>div</code>的子节点<code>p</code>。在处理<code>p</code>节点的过程中，因为<code>p</code>节点不满足静态根节点的条件，因此它会走其他代码生成函数。我们这里为了方便，直接说明结果，至于结果如何来的，我们会在之后的小节中进行介绍：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// p节点的文本内容</span></span>
<span class="line"><span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token string">&#39;_v([&quot;Hello&quot;])&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// p节点</span></span>
<span class="line"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token string">&#39;_c(&quot;p&quot;, [_v([&quot;Hello&quot;])])&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// div节点</span></span>
<span class="line"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token string">&#39;_c(&quot;div&quot;, [_c(&quot;p&quot;, [_v([&quot;Hello&quot;])])])&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// state.staticRenderFns数组</span></span>
<span class="line"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;_c(&quot;div&quot;, [_c(&quot;p&quot;, [_v([&quot;Hello&quot;])])])&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们最后来看<code>genStatic</code>的返回值，因为<code>staticRenderFns</code>数组只有一条数据并且<code>staticInFor</code>为<code>false</code>，因此函数返回值为：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token string">&#39;_m(0)&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在分析完<code>genStatic</code>方法后，我们可以知道：<strong>静态根节点代码生成的render存放在staticRenderFns中，而不是render</strong></p><p>最后回到<code>baseCompile</code>方法，在我们的例子中，我们使用<code>generate</code>生成<code>code</code>后，<code>baseCompile</code>方法的返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token string">&#39;_m(0)&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;_c(&quot;div&quot;, [_c(&quot;p&quot;, [_v([&quot;Hello&quot;])])])&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="genif" tabindex="-1"><a class="header-anchor" href="#genif"><span>genIf</span></a></h2><p><code>genIf</code>是用来处理<code>v-if/v-else</code>等指令的，在前面章节中我们介绍过如果存在<code>v-if/v-else</code>指令，那么其子节点是存放在<code>ifConditions</code>数组中的，以下面代码为例：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> showMsg <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">  &lt;div&gt;</span>
<span class="line">    &lt;div v-if=&quot;showMsg&quot;&gt;show&lt;/div&gt;</span>
<span class="line">    &lt;div v-else&gt;not show&lt;/div&gt;</span>
<span class="line">  &lt;/div&gt;</span>
<span class="line"></span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">ifConditions</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token string">&#39;showMsg&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">&#39;div元素的ast&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">&#39;div元素的ast&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在调用<code>genElement</code>方法的时候，因为<code>ast</code>对象的<code>if</code>属性为<code>true</code>，并且<code>ifProcessed</code>属性为<code>false</code>，所以会调用<code>genIf</code>方法。接下来，我们来看一下<code>genIf</code>方法的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genIf</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> any<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState<span class="token punctuation">,</span></span>
<span class="line">  altGen<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span></span>
<span class="line">  altEmpty<span class="token operator">?</span><span class="token operator">:</span> string</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  el<span class="token punctuation">.</span>ifProcessed <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// avoid recursion</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token function">genIfConditions</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>ifConditions<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> altGen<span class="token punctuation">,</span> altEmpty<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">genIfConditions</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">conditions</span><span class="token operator">:</span> ASTIfConditions<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState<span class="token punctuation">,</span></span>
<span class="line">  altGen<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span></span>
<span class="line">  altEmpty<span class="token operator">?</span><span class="token operator">:</span> string</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>conditions<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> altEmpty <span class="token operator">||</span> <span class="token string">&#39;_e()&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> condition <span class="token operator">=</span> conditions<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">.</span>exp<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>condition<span class="token punctuation">.</span>exp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">      <span class="token function">genTernaryExp</span><span class="token punctuation">(</span>condition<span class="token punctuation">.</span>block<span class="token punctuation">)</span></span>
<span class="line">    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">      <span class="token function">genIfConditions</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span> state<span class="token punctuation">,</span> altGen<span class="token punctuation">,</span> altEmpty<span class="token punctuation">)</span></span>
<span class="line">    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genTernaryExp</span><span class="token punctuation">(</span>condition<span class="token punctuation">.</span>block<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// v-if with v-once should generate code like (a)?_m(0):_m(1)</span></span>
<span class="line">  <span class="token keyword">function</span> <span class="token function">genTernaryExp</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> altGen</span>
<span class="line">      <span class="token operator">?</span> <span class="token function">altGen</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">      <span class="token operator">:</span> el<span class="token punctuation">.</span>once</span>
<span class="line">        <span class="token operator">?</span> <span class="token function">genOnce</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">        <span class="token operator">:</span> <span class="token function">genElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>genIf</code>方法中，它首先把<code>ifProcessed</code>赋值为<code>true</code>，这样做的目的在之前<code>genStatic</code>小节也提到过了，主要是为了防止递归调用<code>genElement</code>时重复执行<code>genIf</code>方法。然后，它调用<code>genIfConditions</code>来处理<code>ifConditions</code>数组。</p><p>在<code>genIfConditions</code>中，它每次获取数组的第一个，然后判断其<code>exp</code>表达式，如果有则使用三目运算表达式来返回，同时会递归调用<code>genIfConditions</code>，如果没有则直接返回<code>genTernaryExp</code>方法的调用结果。</p><p>我们结合之前我们提到的例子，来进行说明：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 第一次调用genIfConditions时</span></span>
<span class="line"><span class="token keyword">const</span> condition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token string">&#39;showMsg&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">&#39;div元素的ast&#39;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// if判断exp为真，调用genTernaryExp，再递归调用genElement，处理div的文本节点</span></span>
<span class="line"><span class="token keyword">const</span> txt <span class="token operator">=</span> <span class="token string">&#39;_v(&quot;show&quot;)&#39;</span></span>
<span class="line"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token string">&#39;_c(&quot;div&quot;, [_v(&quot;show&quot;)])&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 递归调用genIfConditions时</span></span>
<span class="line"><span class="token keyword">const</span> condition <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">block</span><span class="token operator">:</span> <span class="token string">&#39;div元素的ast&#39;</span> <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// if判断exp为假，调用genTernaryExp，再递归调用genElement，处理div的文本节点</span></span>
<span class="line"><span class="token keyword">const</span> txt <span class="token operator">=</span> <span class="token string">&#39;_v(&quot;not show&quot;)&#39;</span></span>
<span class="line"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token string">&#39;_c(&quot;div&quot;, [_v(&quot;not show&quot;)])&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// genIfConditions递归调用结束，genIf方法返回值</span></span>
<span class="line"><span class="token keyword">return</span> <span class="token string">&#39;(showMsg)?_c(&quot;div&quot;, [_v(&quot;show&quot;)]):_c(&quot;div&quot;, [_v(&quot;not show&quot;)])&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再回到<code>baseCompiler</code>方法中，通过<code>generate</code>方法返回<code>code</code>后，最终的返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token string">&#39;with(this){return _c(&quot;div&quot;, [(showMsg)?_c(&quot;div&quot;, [_v(&quot;show&quot;)]):_c(&quot;div&quot;, [_v(&quot;not show&quot;)])])}&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="genfor" tabindex="-1"><a class="header-anchor" href="#genfor"><span>genFor</span></a></h2><p><code>genFor</code>是用来处理<code>v-for</code>循环的，我们以下面代码为例来说明：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;AAA&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;BBB&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;CCC&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">let</span> html <span class="token operator">=</span>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">  &lt;ul&gt;</span>
<span class="line">    &lt;li v-for=&quot;(item, index) in list&quot; :key=&quot;index&quot;&gt;{{item}}&lt;/li&gt;</span>
<span class="line">  &lt;/ul&gt;</span>
<span class="line"></span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在第一次调用<code>genElement</code>因为<code>ul</code>标签上没有任何指令或者属性，也不是一个组件，因此会调用<code>genChildren</code>递归调用<code>genElement</code>来处理子节点。第二次调用<code>genElement</code>时，这个时候处理<code>li</code>标签，因为<code>li</code>标签上存在<code>v-for</code>指令，它的<code>ast</code>对象的<code>for</code>属性为判断为真，并且<code>forProcessed</code>属性为<code>false</code>，因此会调用<code>genFor</code>方法。接下来，我们来看一下<code>genFor</code>方法的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genFor</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> any<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState<span class="token punctuation">,</span></span>
<span class="line">  altGen<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span></span>
<span class="line">  altHelper<span class="token operator">?</span><span class="token operator">:</span> string</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> exp <span class="token operator">=</span> el<span class="token punctuation">.</span>for</span>
<span class="line">  <span class="token keyword">const</span> alias <span class="token operator">=</span> el<span class="token punctuation">.</span>alias</span>
<span class="line">  <span class="token keyword">const</span> iterator1 <span class="token operator">=</span> el<span class="token punctuation">.</span>iterator1 <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>iterator1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token keyword">const</span> iterator2 <span class="token operator">=</span> el<span class="token punctuation">.</span>iterator2 <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>iterator2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"></span>
<span class="line">  el<span class="token punctuation">.</span>forProcessed <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// avoid recursion</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>altHelper <span class="token operator">||</span> <span class="token string">&#39;_l&#39;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">((</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>exp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">),</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span></span>
<span class="line">    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>alias<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>iterator1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>iterator2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">){</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span></span>
<span class="line">      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>altGen <span class="token operator">||</span> genElement<span class="token punctuation">)</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span></span>
<span class="line">    <span class="token string">&#39;})&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>genFor</code>方法的最开始，重新定义了几个属性，根据我们的例子这些属性值为：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> exp <span class="token operator">=</span> <span class="token string">&#39;list&#39;</span></span>
<span class="line"><span class="token keyword">const</span> alias <span class="token operator">=</span> <span class="token string">&#39;item&#39;</span></span>
<span class="line"><span class="token keyword">const</span> iterator1 <span class="token operator">=</span> <span class="token string">&#39;,index&#39;</span></span>
<span class="line"><span class="token keyword">const</span> iterator2 <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着，它通过调用<code>genElement</code>来处理<code>li</code>标签及其的文本节点：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> txt <span class="token operator">=</span> <span class="token string">&#39;_v(_s(item))&#39;</span></span>
<span class="line"><span class="token keyword">const</span> li <span class="token operator">=</span> <span class="token string">&#39;_c(&quot;li&quot;,{key:index},[_v(_s(item))])&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>处理完毕以后，<code>genFor</code>方法的返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token string">&#39;_l((list),function(item,index){return _c(&quot;li&quot;,{key:index},[_v(_s(item))])})&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在<code>genChildren</code>递归处理子节点完毕后，其值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token string">&#39;_c(&quot;ul&quot;,l((list),function(item,index){return _c(&quot;li&quot;,{key:index},[_v(_s(item))])}),0)&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>再回到<code>baseCompiler</code>方法中，通过<code>generate</code>方法返回<code>code</code>后，最终的返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token operator">...</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">render</span><span class="token operator">:</span> <span class="token string">&#39;with(this){return _c(&quot;ul&quot;,l((list),function(item,index){return _c(&quot;li&quot;,{key:index},[_v(_s(item))])}),0)&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">staticRenderFns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="genchildren" tabindex="-1"><a class="header-anchor" href="#genchildren"><span>genChildren</span></a></h2><p><code>genChildren</code>是用来处理子节点的，对于子节点来说通常有两种情况：<code>v-for</code>循环的子节点、正常的子节点。</p><p>在调用<code>genElement</code>的时候，当节点不匹配前面提到的<code>genStatic</code>、<code>genIf</code>和<code>genFor</code>等等情况的时候，证明当前节点是一个普通节点，此时调用<code>genChildren</code>来处理它的子节点，当子节点处理完毕后只需要使用<code>_c</code>把子节点包裹起来就可以了。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genElement</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>inlineTemplate <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">    data <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// data</span></span>
<span class="line">  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">    children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token comment">// children</span></span>
<span class="line">  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来，我们来看一下<code>genChildren</code>的代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genChildren</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState<span class="token punctuation">,</span></span>
<span class="line">  checkSkip<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span></span>
<span class="line">  altGenElement<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span></span>
<span class="line">  altGenNode<span class="token operator">?</span><span class="token operator">:</span> Function</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>children</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token literal-property property">el</span><span class="token operator">:</span> any <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token comment">// optimize single v-for</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">      el<span class="token punctuation">.</span>for <span class="token operator">&amp;&amp;</span></span>
<span class="line">      el<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">&#39;template&#39;</span> <span class="token operator">&amp;&amp;</span></span>
<span class="line">      el<span class="token punctuation">.</span>tag <span class="token operator">!==</span> <span class="token string">&#39;slot&#39;</span></span>
<span class="line">    <span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> normalizationType <span class="token operator">=</span> checkSkip</span>
<span class="line">        <span class="token operator">?</span> state<span class="token punctuation">.</span><span class="token function">maybeComponent</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,1</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,0</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">        <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>altGenElement <span class="token operator">||</span> genElement<span class="token punctuation">)</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>normalizationType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> normalizationType <span class="token operator">=</span> checkSkip</span>
<span class="line">      <span class="token operator">?</span> <span class="token function">getNormalizationType</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> state<span class="token punctuation">.</span>maybeComponent<span class="token punctuation">)</span></span>
<span class="line">      <span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">const</span> gen <span class="token operator">=</span> altGenNode <span class="token operator">||</span> genNode</span>
<span class="line">    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">gen</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">      normalizationType <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>normalizationType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="v-for遍历子节点" tabindex="-1"><a class="header-anchor" href="#v-for遍历子节点"><span>v-for遍历子节点</span></a></h3><p>我们可以在<code>genChildren</code>中看到，它首先对<code>v-for</code>循环遍历的情况做了判断，为了更好的理解，我们使用在<code>genFor</code>小结的例子来举例说明：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;AAA&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;BBB&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;CCC&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">&lt;ul&gt;</span>
<span class="line">  &lt;li v-for=&quot;item in list&quot; :key=&quot;item&quot;&gt;{{item}}&lt;/li&gt;</span>
<span class="line">&lt;/ul&gt;</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当第一次调用<code>genElement</code>处理<code>ul</code>标签的时候，因为<code>ul</code>上没有任何属性或者指令，因此调用<code>genChildren</code>开始处理子节点。在<code>if</code>分支条件判断时，其值为真，会递归调用<code>genElement</code>来处理<code>li</code>标签。此时<code>li</code>标签因为有<code>v-for</code>，所以会使用<code>genFor</code>来处理，当<code>genFor</code>处理完毕后，其返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token string">&#39;_l((list),function(item){return _c(&quot;li&quot;,{key:item},[_v(_s(item))])})&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>待<code>li</code>标签处理完毕后，<code>genChildren</code>的返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_l((list),function(item){return _c(&#39;li&#39;,{key:item},[_v(_s(item))])}),0</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>此时<code>ul</code>标签调用<code>genChildren</code>处理子节点完毕，最后使用<code>_c</code>把<code>children</code>包裹起来并赋值给<code>code</code>，其值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;ul&#39;,_l((list),function(item){return _c(&#39;li&#39;,{key:item},[_v(_s(item))])}),0)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="普通子节点" tabindex="-1"><a class="header-anchor" href="#普通子节点"><span>普通子节点</span></a></h3><p>在介绍完<code>v-for</code>遍历子节点后，我们来看一种正常子节点的案例：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span></span>
<span class="line"><span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">&lt;div&gt;</span>
<span class="line">  &lt;p&gt;{{msg}}&lt;/p&gt;</span>
<span class="line">  &lt;p&gt;no data&lt;/p&gt;</span>
<span class="line">  文本节点</span>
<span class="line">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>因为<code>div</code>标签上没有任何属性和指令，因此它会调用<code>genChildren</code>来处理子节点，当执行到<code>genChildren</code>后，它不满足<code>if</code>分支的逻辑判断条件，因此会执行下面这段代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genChildren</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState<span class="token punctuation">,</span></span>
<span class="line">  checkSkip<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span></span>
<span class="line">  altGenElement<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span></span>
<span class="line">  altGenNode<span class="token operator">?</span><span class="token operator">:</span> Function</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>children</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token literal-property property">el</span><span class="token operator">:</span> any <span class="token operator">=</span> children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token comment">// ...省略v-for相关</span></span>
<span class="line">    <span class="token keyword">const</span> normalizationType <span class="token operator">=</span> checkSkip</span>
<span class="line">      <span class="token operator">?</span> <span class="token function">getNormalizationType</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> state<span class="token punctuation">.</span>maybeComponent<span class="token punctuation">)</span></span>
<span class="line">      <span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">const</span> gen <span class="token operator">=</span> altGenNode <span class="token operator">||</span> genNode</span>
<span class="line">    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=&gt;</span> <span class="token function">gen</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">      normalizationType <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>normalizationType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>genChildren</code>代码中，它会遍历<code>children</code>子节点数组，通过<code>genNode</code>按照<code>ast</code>的<code>type</code>类型分情况调用<code>genElement</code>、<code>genComment</code>和<code>genText</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">genNode</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">node</span><span class="token operator">:</span> ASTNode<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genElement</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>isComment<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genComment</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">genText</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genText</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">text</span><span class="token operator">:</span> ASTText <span class="token operator">|</span> ASTExpression</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_v(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token number">2</span></span>
<span class="line">    <span class="token operator">?</span> text<span class="token punctuation">.</span>expression <span class="token comment">// no need for () because already wrapped in _s()</span></span>
<span class="line">    <span class="token operator">:</span> <span class="token function">transformSpecialNewlines</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genComment</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">comment</span><span class="token operator">:</span> ASTText</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_e(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码分析：</p><ul><li>当<code>children</code>第一次遍历时，它是一个<code>p</code>标签并且子节点是一个带变量的插值表达式，会递归调用<code>genElement</code>，在遍历完毕后，它的返回值如下：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;p&#39;, [_v(_s(msg))])</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>当<code>children</code>第二次遍历时，它同样是一个<code>p</code>标签，但它是一个静态节点，其子节点是一个纯文本，会递归调用<code>genElement</code>，在遍历完毕后，它的返回值如下：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;p&#39;, [_v(&#39;no data&#39;)])</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>当<code>children</code>第三次遍历时，它是一个纯文本，会调用<code>genText</code>来处理，在遍历完毕后，它的返回值如下：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_v(&#39;文本节点&#39;)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>最后，当<code>children</code>都遍历完毕后，会调用<code>join(&#39;,&#39;)</code>方法把数组元素用逗号连接成字符串，也就是说<code>genChildren</code>的返回值如下：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[_c(&#39;p&#39;, [_v(_s(msg))]),_c(&#39;p&#39;, [_v(&#39;no data&#39;)]),_v(&#39;文本节点&#39;)]</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>genChildren</code>处理子节点完毕以后，会使用<code>_c</code>把子节点包裹起来并赋值给<code>code</code>，其值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&#39;div&#39;, [_c(&#39;p&#39;, [_v(_s(msg))]),_c(&#39;p&#39;, [_v(&#39;no data&#39;)]),_v(&#39;文本节点&#39;)])</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="gencomponent" tabindex="-1"><a class="header-anchor" href="#gencomponent"><span>genComponent</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genElement</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    code <span class="token operator">=</span> <span class="token function">genComponent</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>component<span class="token punctuation">,</span> el<span class="token punctuation">,</span> state<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> code</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们在<code>genElement</code>方法中可以看到，想要调用<code>genComponent</code>方法，<code>AST</code>的<code>component</code>属性必须有值。我们先来看一下<code>component</code>属性什么时候被赋值，其实它是在<code>parse</code>编译的时候赋值的，在<code>processComponent</code>方法中有如下代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">processComponent</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> binding</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>binding <span class="token operator">=</span> <span class="token function">getBindingAttr</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">&#39;is&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    el<span class="token punctuation">.</span>component <span class="token operator">=</span> binding</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getAndRemoveAttr</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">&#39;inline-template&#39;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    el<span class="token punctuation">.</span>inlineTemplate <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以看到，它使用<code>getBindingAttr</code>获取了<code>is</code>属性，如果有值且判断为真则赋值给<code>el.component</code>。那么，让我们回想一下什么组件可以撰写<code>is</code>属性呢？答案是内置组件<code>component</code>，也就是说<code>genComponent</code>是用来处理<code>component</code>内置组件的。</p><p>根据我们的分析，我们假设有如下案例：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&#39;App&#39;</span></span>
<span class="line"><span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token string">&#39;&lt;component :is=&quot;name&quot; /&gt;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>当调用<code>genElement</code>方法的时候，因为<code>el.component</code>值为<code>name</code>，条件判断为真调用<code>genComponent</code>。我们来看一下<code>genComponent</code>方法的实现代码，如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">genComponent</span> <span class="token punctuation">(</span></span>
<span class="line">  <span class="token parameter"><span class="token literal-property property">componentName</span><span class="token operator">:</span> string<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> children <span class="token operator">=</span> el<span class="token punctuation">.</span>inlineTemplate <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> <span class="token function">genChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genData</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span></span>
<span class="line">    children <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>children<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>genComponent</code>代码不是很多，因为<code>component</code>内置组件没有子节点，所以<code>genChildren</code>不返回任何内容。就我们的例子而言，它最后的返回值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(name,{tag:&quot;component&quot;}</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你可能会很好奇，返回值中的<code>tag:&quot;component&quot;</code>是如何来的，它其实是通过<code>genData</code>方法返回的。在<code>genData</code>方法中，对于内置组件<code>component</code>处理的相关代码如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&#39;{&#39;</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">tag:&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">,$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;}&#39;</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token keyword">return</span> data</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="gendata" tabindex="-1"><a class="header-anchor" href="#gendata"><span>genData</span></a></h2><p><code>genData</code>是用来处理节点上各种属性、指令、事件、作用域插槽以及<code>ref</code>等等，它的功能非常多，代码也多，但并不是很复杂，更多的是使用<code>if</code>分支来判断以上各种情况。</p><p>因此，为了有针对性的学习我们并不会对<code>genData</code>的每一行代码进行说明，而是针对几个常用的<code>case</code>案例来分析。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">genData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> CodegenState</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&#39;{&#39;</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token comment">// key</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">key:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// ref</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ref:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>ref<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// module data generation functions</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> state<span class="token punctuation">.</span>dataGenFns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> state<span class="token punctuation">.</span>dataGenFns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// attributes</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">attrs:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genProps</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>attrs<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  data <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">,$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;}&#39;</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token keyword">return</span> data</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>假设，我们有如下<code>template</code>模板：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>
<span class="line">  &lt;div&gt;</span>
<span class="line">    &lt;p ref=&quot;pRef&quot; key=&quot;p&quot;&gt;123&lt;/p&gt;</span>
<span class="line">    &lt;div class=&quot;box&quot; style=&quot;{width:100px}&quot; data-index=&quot;100&quot;&gt;&lt;/div&gt;</span>
<span class="line">  &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码分析：</p><ul><li>当处理<code>p</code>标签的时候，因为它有<code>ref</code>和<code>key</code>两属性，因此其返回值和生成的<code>code</code>如下：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{ref:&quot;pRef&quot;,key:&quot;p&quot;}</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&quot;p&quot;, {ref:&quot;pRef&quot;,key:&quot;p&quot;}, [_v(&quot;123&quot;)])</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>当处理<code>div</code>标签的时候，它有<code>class</code>和<code>style</code>，对于这两个属性它们是使用<code>state.dataGenFns</code>来处理的。在<code>CodegenState</code>构造函数中，有这样一段代码：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CodegenState</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">options</span><span class="token operator">:</span> CompilerOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>dataGenFns <span class="token operator">=</span> <span class="token function">pluckModuleFunction</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>modules<span class="token punctuation">,</span> <span class="token string">&#39;genData&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// ...</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实例属性<code>dataGenFns</code>是通过所处不同的平台扩展而来的，对于<code>Web</code>浏览器端而言，<code>css Module</code>和<code>style Module</code>都定义了<code>genData</code>方法，它们在<code>src/platforms/web/compiler/modules</code>目录下的<code>class.js</code>和<code>style.js</code>。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// css module</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">genData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>staticStyle<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">staticStyle:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>staticStyle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>styleBinding<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">style:(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>styleBinding<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">),</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> data</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// style module</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">genData</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">el</span><span class="token operator">:</span> ASTElement</span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>staticClass<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">staticClass:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>staticClass<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>classBinding<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    data <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">class:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>el<span class="token punctuation">.</span>classBinding<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">return</span> data</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以对于实例属性<code>dataGenFns</code>而言，它是一个数组，其中有两个元素，一个是<code>css</code>的<code>genData</code>方法，另外一个是<code>style</code>的<code>genData</code>方法。当<code>for</code>循环遍历<code>state.dataGenFns</code>的时候，会分别调用它们。在遍历完毕后，此时的<code>data</code>值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{staticClass:&quot;box&quot;,staticStyle:{&quot;{width&quot;:&quot;100px}&quot;},</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>最后，就是来处理<code>data-index</code>属性，它是通过<code>genProps</code>来处理的，这个方法的代码如下：</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">function</span> <span class="token function">genProps</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>ASTAttr<span class="token operator">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> string <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> staticProps <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token keyword">let</span> dynamicProps <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> props<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> prop <span class="token operator">=</span> props<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">const</span> value <span class="token operator">=</span> __WEEX__</span>
<span class="line">      <span class="token operator">?</span> <span class="token function">generateValue</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>
<span class="line">      <span class="token operator">:</span> <span class="token function">transformSpecialNewlines</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>dynamic<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      dynamicProps <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">      staticProps <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  staticProps <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>staticProps<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>dynamicProps<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_d(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>staticProps<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dynamicProps<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">])</span><span class="token template-punctuation string">`</span></span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> staticProps</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当<code>genData</code>执行到最后时，其<code>data</code>返回值以及<code>div</code>标签生成<code>code</code>的值如下：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{staticClass:&quot;box&quot;,staticStyle:{&quot;{width&quot;:&quot;100px}&quot;},attrs:{&quot;data-index&quot;:&quot;100&quot;}}</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"><span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_c(&quot;div&quot;, {staticClass:&quot;box&quot;,staticStyle:{&quot;{width&quot;:&quot;100px}&quot;},attrs:{&quot;data-index&quot;:&quot;100&quot;}})</span><span class="token template-punctuation string">`</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>小结</strong>：在分析完<code>genData</code>这一小节后，标志着<code>codegen</code>代码生成章节已经全部介绍完毕了，通过这一章节我们知道了把<code>AST</code>转换成<code>code</code>过程中的各种细节。虽然我们极力撰写很多案例来说明，但依旧很有多逻辑我们无法覆盖到，例如：插槽/作用域插槽，<code>event</code>事件以及<code>v-model</code>等等。对于这些内容，我们会安排在后续的<strong>扩展</strong>章节进行分析。</p></div><!--[--><!--[--><div id="comment" class="giscus-wrapper input-top vp-comment layout-comment" vp-comment style="display:block;" data-v-ad8a078f><div style="display: flex;align-items: center;justify-content: center;height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!--]--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><time class="meta-item-info" datetime="2025-04-14T15:01:38.000Z" data-allow-mismatch>2025/4/14 15:01</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: why583440138@gmail.com">wangtunan</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/blog/vueAnalysis/compile/optimize.html" aria-label="optimize优化"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">optimize优化</span></div><!--]--></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-BfeJmovj.js" defer></script>
  </body>
</html>
